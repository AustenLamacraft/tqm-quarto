<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>B is for Bunching – Theories of Quantum Matter</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../notes/lattice-models.html" rel="next">
<link href="../notes/second-quantization.html" rel="prev">
<link href="../favicon-32x32.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-5b4ad623e5705c0698d39aec6f10cf02.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../notes/intro.html">Notes</a></li><li class="breadcrumb-item"><a href="../notes/more-second-quantization.html">B is for Bunching</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      </a>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TQM Lectures 2025</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Notes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/many-body-wavefunctions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Many Body Wavefunctions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/quantum-hall-effect.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quantum Hall Effect</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/elastic-chain.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Elastic Chain</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/spin-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spin Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/second-quantization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A is for Annihilation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/more-second-quantization.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">B is for Bunching</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/lattice-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lattice Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/bose-gas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bose Gas</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/fermi-gas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fermi Gas</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/superconductivity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Superconductivity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/response-and-correlation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Response and Correlation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Slides</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../slides/many-body-wavefunctions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Many Body Wavefunctions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../slides/quantum-hall-effect.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quantum Hall Effect</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../slides/elastic-chain.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Elastic Chain</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../slides/spin-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spin Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../slides/second-quantization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A is for Annihilation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../slides/more-second-quantization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">B is for Bunching</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../slides/lattice-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lattice Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../slides/bose-gas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bose Gas</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../slides/fermi-gas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fermi Gas</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../slides/superconductivity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Superconductivity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../slides/response-and-correlation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Response and Correlation</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Problem Sets</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../problem-sets/problem-set-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problem Set 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../problem-sets/problem-set-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problem Set 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../problem-sets/problem-set-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problem Set 3</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../past-papers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Past Papers</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#correlation-functions" id="toc-correlation-functions" class="nav-link active" data-scroll-target="#correlation-functions"><span class="header-section-number">1</span> Correlation Functions</a>
  <ul class="collapse">
  <li><a href="#correlation-functions-in-second-quantization" id="toc-correlation-functions-in-second-quantization" class="nav-link" data-scroll-target="#correlation-functions-in-second-quantization"><span class="header-section-number">1.1</span> Correlation Functions in Second Quantization</a></li>
  <li><a href="#the-hanbury-brown-and-twiss-effect" id="toc-the-hanbury-brown-and-twiss-effect" class="nav-link" data-scroll-target="#the-hanbury-brown-and-twiss-effect"><span class="header-section-number">1.2</span> The Hanbury Brown and Twiss Effect</a></li>
  </ul></li>
  <li><a href="#hartreefock-theory" id="toc-hartreefock-theory" class="nav-link" data-scroll-target="#hartreefock-theory"><span class="header-section-number">2</span> Hartree–Fock Theory</a>
  <ul class="collapse">
  <li><a href="#the-hartree-and-fock-potentials" id="toc-the-hartree-and-fock-potentials" class="nav-link" data-scroll-target="#the-hartree-and-fock-potentials"><span class="header-section-number">2.1</span> The Hartree and Fock Potentials</a></li>
  <li><a href="#hartreefock-for-the-electron-gas" id="toc-hartreefock-for-the-electron-gas" class="nav-link" data-scroll-target="#hartreefock-for-the-electron-gas"><span class="header-section-number">2.2</span> Hartree–Fock for the Electron Gas</a></li>
  <li><a href="#stoner-criterion-for-ferromagnetism" id="toc-stoner-criterion-for-ferromagnetism" class="nav-link" data-scroll-target="#stoner-criterion-for-ferromagnetism"><span class="header-section-number">2.3</span> Stoner Criterion for Ferromagnetism</a></li>
  <li><a href="#excited-state-energies" id="toc-excited-state-energies" class="nav-link" data-scroll-target="#excited-state-energies"><span class="header-section-number">2.4</span> Excited State Energies</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="more-second-quantization.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../notes/intro.html">Notes</a></li><li class="breadcrumb-item"><a href="../notes/more-second-quantization.html">B is for Bunching</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">B is for Bunching</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="hidden">
<!-- See https://stackoverflow.com/questions/76398554/how-to-define-latex-macros-globally-for-a-quarto-book -->
<!-- 
Can't get these to work with tex output at the moment because they end up after \begin{document}
\DeclareMathOperator{\tr}{tr}
\DeclareMathOperator{\E}{\mathbb{E}} 
-->
</div>
<p>Bose or Fermi statistics gives rise to correlations in the positions of particles in a many body system, even in product states. These correlations affect the energy of many particle states, and provide the basis of the simplest approximate theories.</p>
<p>Reading: <span class="citation" data-cites="nazarov2013advanced">Nazarov and Danon (<a href="#ref-nazarov2013advanced" role="doc-biblioref">2013</a>)</span>, <span class="citation" data-cites="baym2018lectures">Baym (<a href="#ref-baym2018lectures" role="doc-biblioref">2018</a>)</span></p>
<hr>
<section id="correlation-functions" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="correlation-functions"><span class="header-section-number">1</span> Correlation Functions</h2>
<p>In <a href="../notes/many-body-wavefunctions.html">Lecture 1</a> we introduced the <strong>pair distribution function</strong></p>
<p><span id="eq-pdf"><span class="math display">\[
\rho_2(x_1,x_2) = N(N-1) \int dx_3\ldots dx_N \,\left|\Psi(x_1,x_2,\ldots,x_N)\right|^2,
\tag{1}\]</span></span></p>
<p>which measures the likelihood of finding a pair of particles at <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span>. We also saw that <span class="math inline">\(\rho_2(x_1,x_2)\)</span> could be related to the expectation of the product of the density operators <span class="math inline">\(\rho(x)\)</span> at different points.</p>
<p><span id="eq-rho-rho-norm"><span class="math display">\[
\rho_2(x_1,x_2) = \langle{\Psi}\rvert\rho(x_1)\rho(x_2)\lvert{\Psi}\rangle - \rho_1(x_1)\delta(x_1-x_2),
\tag{2}\]</span></span></p>
<p>where <span class="math inline">\(\rho_1(x)= \langle{\Psi}\rvert \rho(x) \lvert \Psi \rangle\)</span>. <span class="math inline">\(\rho_2(x,y)\)</span> is the simplest example of a <strong>correlation function</strong>. Note also that the quantity <span class="math inline">\(\langle{\Psi}\rvert \rho_q \rho_{-q} \lvert{\Psi}\rangle\)</span>, used to quantify the crystalline order in a solid in <a href="../notes/elastic-chain.html">Lecture 3</a>, is just the Fourier transform of <span class="math inline">\(\rho_2(x_1,x_2)\)</span>. Higher correlation functions, involving products of more than two density operators, provide more detailed information on the distribution of the particles.</p>
<section id="correlation-functions-in-second-quantization" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="correlation-functions-in-second-quantization"><span class="header-section-number">1.1</span> Correlation Functions in Second Quantization</h3>
<p>We evaluated <span class="math inline">\(\rho_2(x,y)\)</span> for the 1D Fermi gas:</p>
<p><span id="eq-rho2-eval-fermi"><span class="math display">\[
\rho_2(x,y) = n^2\left[1 - \left(\frac{\sin[k_\text{F}(x-y)]}{k_\text{F}(x-y)}\right)^2\right].
\tag{3}\]</span></span></p>
<p>Let’s see how to reproduce this result using second quantization. <span class="math inline">\(\rho_2(x,y)\)</span> can be written in second quantized notation as</p>
<p><span id="eq-rho2-2nd-quant"><span class="math display">\[
\rho_2(x,y) =\langle{\Psi}\rvert \psi^\dagger(x)\psi^\dagger(y)\psi^{\vphantom{\dagger}}(y)\psi^{\vphantom{\dagger}}(x) \lvert \Psi \rangle.
\tag{4}\]</span></span></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Check
</div>
</div>
<div class="callout-body-container callout-body">
<p>Perhaps the simplest way to get this formula is to use the correspondence that we found in <a href="../notes/second-quantization.html">Lecture 5</a> <span class="math display">\[
\begin{aligned}
\lvert{\Psi}\rangle&amp;\longleftrightarrow \Psi(x_1,\ldots, x_N)\nonumber\\
\psi(X)\lvert{\Psi}\rangle&amp;\longleftrightarrow \sqrt{N}\Psi(X,x_1,\ldots, x_{N-1})\\
\end{aligned}
\]</span></p>
<p>Show that <a href="#eq-pdf" class="quarto-xref">Equation&nbsp;1</a> implies <a href="#eq-rho2-2nd-quant" class="quarto-xref">Equation&nbsp;4</a>.</p>
</div>
</div>
<p><a href="#eq-rho2-2nd-quant" class="quarto-xref">Equation&nbsp;4</a> differs from <span class="math inline">\(\langle{\Psi}\rvert\rho(x)\rho(y)\lvert{\Psi}\rangle\)</span> by the ordering of operators. Using the canonical commutation relations for the fields gives the relation <a href="#eq-rho-rho-norm" class="quarto-xref">Equation&nbsp;2</a> for both bosons and fermions.</p>
<p>Let’s evaluate <a href="#eq-rho2-2nd-quant" class="quarto-xref">Equation&nbsp;4</a> for the ground state of the Fermi gas. We will find the result for a general product state, using the same strategy as we used in the last lecture for the single particle density matrix. That is, we substitute the expansion of the fields <span class="math inline">\(\psi^{\vphantom{\dagger}}(x)\)</span> and <span class="math inline">\(\psi^\dagger(x)\)</span> in terms of the orthonormal single particle states making up the product state</p>
<p><span class="math display">\[
\begin{aligned}
    \psi^{\vphantom{\dagger}}(x)=\sum_{\beta}  \varphi^{}_{\beta}(x)a^{\vphantom{\dagger}}_{\beta},\nonumber\\
  \psi^\dagger(x)=\sum_{\beta}  \varphi^*_{\beta}(x)a^\dagger_{\beta}.
\end{aligned}
\]</span></p>
<p>This gives</p>
<p><span class="math display">\[
    \label{2nd_quant_CEval}
    \rho_2(x,y)=\sum_{\alpha, \beta, \gamma, \delta}\varphi^{*}_{\alpha}(x)\varphi^{*}_{\beta}(y)\varphi^{}_{\gamma}(y)\varphi^{}_{\delta}(x)\langle{\Psi}\rvert a^\dagger_{\alpha}a^\dagger_{\beta}a^{\vphantom{\dagger}}_{\gamma}a^{\vphantom{\dagger}}_{\delta} \lvert \Psi \rangle.
\]</span></p>
<p>If we are considering the expectation in a state of the form <span class="math inline">\(\lvert{\mathbf{N}}\rangle\)</span>, we can see that an annihilation operator for a given single particle state must be accompanied by a creation operator for the same state. There are therefore two possibilities</p>
<p><span class="math display">\[
\begin{aligned}
    &amp;\alpha =\delta,\, \beta=\gamma, \text{ or }\nonumber\\
  &amp;\alpha=\gamma,\, \beta=\delta,
\end{aligned}
\]</span></p>
<p>which give rise to two groups of terms</p>
<p><span class="math display">\[
\begin{aligned}
\langle{\mathbf{N}}\rvert a^\dagger_{\alpha}a^\dagger_{\gamma}a^{\vphantom{\dagger}}_{\gamma}a^{\vphantom{\dagger}}_{\alpha} \lvert \mathbf{N} \rangle&amp;=N_{\alpha}N_{\gamma}\nonumber\\
    \langle{\mathbf{N}}\rvert a^\dagger_{\alpha}a^\dagger_{\gamma}a^{\vphantom{\dagger}}_{\alpha}a^{\vphantom{\dagger}}_{\gamma} \lvert \mathbf{N} \rangle&amp;=\pm N_{\alpha}N_{\gamma}\qquad\text{if }\alpha\neq\gamma,
\end{aligned}
\]</span></p>
<p>the <span class="math inline">\(\pm\)</span> corresponding to bosons and fermions respectively. Thus we have</p>
<p><span id="eq-rho2-result"><span class="math display">\[
\begin{aligned}
\rho_2(x,y)=\sum_{\alpha, \beta}N_\alpha N_\beta\left[\lvert{\varphi_{\alpha}(x)}\rvert^2\lvert{\varphi_{\beta}(y)}\rvert^2 \pm \varphi^*_\alpha(x)\varphi^{}_\alpha(y)\varphi^*_\beta(y)\varphi^{}_\beta(x) \right].
\end{aligned}
\tag{5}\]</span></span></p>
<p>You might notice that this expression weights the case <span class="math inline">\(\alpha=\beta=\gamma=\delta\)</span> by a factor <span class="math inline">\(2N_\alpha^2\)</span> when it should have <span class="math inline">\(N_\alpha(N_\alpha-1)\)</span> in the case of bosons, and zero for fermions. On the other hand, such cases amount to a sum over a <em>single index</em>, where the general case is a sum over a double index. It seems reasonable, then, that this accounting error is not important in the thermodynamic limit. For instance, in the case that <span class="math inline">\(\varphi_\alpha(x)\)</span> are plane wave states we have the usual prescription</p>
<p><span class="math display">\[
\sum_\alpha(\cdots) \longrightarrow L\int (\cdots)\frac{dk}{2\pi},
\]</span></p>
<p>assuming the integrand is smooth. In this case the error in <a href="#eq-rho2-result" class="quarto-xref">Equation&nbsp;5</a> is a factor of <span class="math inline">\(L^{-1}\)</span> smaller than what we retain. We do however have to be careful in Bose condensates, where one state has a finite fraction of the particles and this argument does not apply.</p>
<p>We can express the result <a href="#eq-rho2-result" class="quarto-xref">Equation&nbsp;5</a> in terms of the density and density matrix as</p>
<p><span id="eq-rho2-compact"><span class="math display">\[
\rho_2(x,y) = \rho_1(x)\rho_1(y) \pm g(x,y)g(y,x),
\tag{6}\]</span></span></p>
<p>which, in the case of the ground state of the Fermi gas, reproduces <a href="#eq-rho2-eval-fermi" class="quarto-xref">Equation&nbsp;3</a>. We see that the correlation function vanishes as the separation <span class="math inline">\(x-y\to 0\)</span>, because <span class="math inline">\(g(x,x)=\langle\mathop{\rho(y)}\rangle\)</span>. This is, of course, another manifestation of the exclusion principle: it is not possible for two fermions to sit on top of each other. The scale of the ‘hole’ in the correlation function is of course set by the mean interparticle separation, or Fermi wavelength. Note also the decaying oscillations, indicating liquid-like correlations in the positions of the particles. These are sometimes known as <strong>Friedel oscillations</strong>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/1DFermiGasCorrelation.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption>Correlation function <span class="math inline">\(\rho_2(x,0)\)</span> for the Fermi gas.</figcaption>
</figure>
</div>
<p>For bosons the situation is very different. If <span class="math inline">\(g(x,y)\to 0\)</span> as <span class="math inline">\(\lvert{x-y}\rvert\to\infty\)</span>, the value of the correlation function as <span class="math inline">\(\lvert{x-y}\rvert\to 0\)</span> is <em>twice</em> the value at <span class="math inline">\(\lvert{x-y}\rvert\to\infty\)</span>. This characteristic behavior is often termed <strong>bunching</strong>: a pair of bosons is more likely to be found at two nearby points than at two distant points.</p>
<p>Nothing about the result <a href="#eq-rho2-compact" class="quarto-xref">Equation&nbsp;6</a> is special to 1D of course: one just has to recalculate the density and density matrix. Remember, though, that it does only apply to product states.</p>
</section>
<section id="the-hanbury-brown-and-twiss-effect" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="the-hanbury-brown-and-twiss-effect"><span class="header-section-number">1.2</span> The Hanbury Brown and Twiss Effect</h3>
<p>The result for the density correlations <a href="#eq-rho2-result" class="quarto-xref">Equation&nbsp;5</a> or <a href="#eq-rho2-compact" class="quarto-xref">Equation&nbsp;6</a> can be viewed as a kind of interference effect that shows up in the correlations of the intensity of a quantum waves, even when there is no interference in the intensity itself. To illustrate this interpretation, we consider a classic experiment from with Bose condensates described in <span class="citation" data-cites="andrews1997observation">Andrews et al. (<a href="#ref-andrews1997observation" role="doc-biblioref">1997</a>)</span>.</p>
<p>Consider a gas of <span class="math inline">\(N\)</span> noninteracting bosons occupying the lowest energy level of some potential well: a <strong>Bose condensate</strong>. If the ground state wavefunction is <span class="math inline">\(\varphi_{0}(\mathbf{r})\)</span>, the <span class="math inline">\(N\)</span>-body wavefunction for such a state is</p>
<p><span class="math display">\[
    \Psi(\mathbf{r}_1,\mathbf{r}_2,\ldots,\mathbf{r}_N)=\prod_i^N \varphi_0(\mathbf{r}_i),
  \label{2nd_quant_BoseGroundState}
\]</span></p>
<p>which we can write in second quantized notation as</p>
<p><span class="math display">\[
    \lvert{\Psi}\rangle=\frac{1}{\sqrt{N!}}\left(a^\dagger_0\right)^N\lvert{\text{VAC}}\rangle,
\]</span></p>
<p>where <span class="math inline">\(a^\dagger_0\)</span> creates a particle in the state <span class="math inline">\(\varphi_0(\mathbf{r})\)</span>. Imagine that we took another well, also filled with <span class="math inline">\(N\)</span> bosons, and placed it alongside the first. If we switch off the potentials at some instant, the particles will fly out, with wavefunctions orginating in the two wells overlapping. Precisely this experiment was reported in <span class="citation" data-cites="andrews1997observation">Andrews et al. (<a href="#ref-andrews1997observation" role="doc-biblioref">1997</a>)</span>. What do we expect to see?</p>
<p>Let us denote by <span class="math inline">\(\varphi_L(\mathbf{r})\)</span> and <span class="math inline">\(\varphi_R(\mathbf{r})\)</span> the ground states of two spatially separated potential wells. First, consider a state where each boson is in a superposition of <span class="math inline">\(\varphi_L(\mathbf{r})\)</span> and <span class="math inline">\(\varphi_R(\mathbf{r})\)</span>. Such a situation could arise by starting from a single well and adiabatically splitting it in two. We can write such a state as</p>
<p><span class="math display">\[
    \lvert{\bar N_L,\bar N_R}\rangle_\theta\equiv\frac{1}{\sqrt{N!}}\left[\sqrt{\frac{\bar N_L}{N}}e^{-i\theta/2}
    a^\dagger_L+\sqrt{\frac{\bar N_R}{N}}e^{i\theta/2}a^\dagger_R\right]^N\lvert{\text{VAC}}\rangle,
  \label{more_two}
\]</span></p>
<p>where <span class="math inline">\(\bar N_{L,R}\)</span> are the expectation values of particle number in each state <span class="math inline">\(N=\bar N_L+\bar N_R\)</span>. We allow the system to evolve for some time <span class="math inline">\(t\)</span>, so that the two `clouds’ begin to overlap (typically achieved by allowing free expansion i.e.&nbsp;turning off the confining potentials). If we consider the time evolution in the Heisenberg picture then, as we saw last time, the field operator obeys the free particle Schrödinger equation (ignoring interactions)</p>
<p><span class="math display">\[
i\frac{\partial \psi^{\vphantom{\dagger}}(\mathbf{r},t)}{\partial t} = -\frac{1}{2m}\nabla^2\psi^{\vphantom{\dagger}}(\mathbf{r},t).
\]</span></p>
<p>We write the field operator as</p>
<p><span class="math display">\[
\psi^{\vphantom{\dagger}}(\mathbf{r})=\varphi_L(\mathbf{r},t)a^{\vphantom{\dagger}}_L+\varphi_R(\mathbf{r},t)a^{\vphantom{\dagger}}_R+\cdots,
\]</span></p>
<p>where the wavefunctions <span class="math inline">\(\varphi_{L/R}(\mathbf{r},t)\)</span> are evolving freely, and the dots denote the other states in some complete orthogonal set that includes <span class="math inline">\(\varphi_L(\mathbf{r})\)</span> and <span class="math inline">\(\varphi_R(\mathbf{r})\)</span>: we can ignore them because they are empty. A calculation of the expectation value of <span class="math inline">\(\rho(\mathbf{r})=\psi^\dagger(\mathbf{r})\psi^{\vphantom{\dagger}}(\mathbf{r})\)</span> gives</p>
<p><span id="eq-dens-int"><span class="math display">\[
    \begin{aligned}
    \rho_1(\mathbf{r},t)=\bar N_L|\varphi_L(\mathbf{r},t)|^2+\bar N_R|\varphi_R(\mathbf{r},t)|^2+\overbrace{2\sqrt{\bar N_L \bar
    N_R}\mathrm{Re}\,e^{i\theta}\,\varphi^*_L(\mathbf{r},t)\varphi_R(\mathbf{r},t)}^{\equiv\rho_{\mathrm{int}(
    \mathbf{r},t)}}.
    \end{aligned}
\tag{7}\]</span></span></p>
<p>If the clouds begin to overlap, the last term in <a href="#eq-dens-int" class="quarto-xref">Equation&nbsp;7</a> comes into play. Its origin is in quantum interference between the two coherent subsystems, showing that the <em>relative phase</em> has a real physical effect.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Check
</div>
</div>
<div class="callout-body-container callout-body">
<p>Consider a Gaussian wavefunction of width <span class="math inline">\(R_0\)</span> at time <span class="math inline">\(t=0\)</span>. Show (by substitution into the Schrödinger equation is fine) that this function evolves as</p>
<p><span id="eq-gaussian"><span class="math display">\[
\varphi(\mathbf{r},t)=\frac{1}{\left(\pi R_t^{2}\right)^{3/4}}\exp\left[-\frac{\mathbf{r}^2\left(1+i t/m R_0^2)\right)}{2R_t^2}\right],
\tag{8}\]</span></span></p>
<p>where</p>
<p><span class="math display">\[
R_t^2=R_0^2+\left(\frac{ t}{mR_0}\right)^2.
\]</span></p>
</div>
</div>
<p><a href="#eq-gaussian" class="quarto-xref">Equation&nbsp;8</a> illustrates a very important point about the expansion of a gas. After a long period of expansion, the final density distribution is a reflection of the initial <em>momentum</em> distribution. This is simply because faster moving atoms fly further, so after time <span class="math inline">\(t\)</span> an atom with velocity <span class="math inline">\(\mathbf{v}\)</span> will be at position <span class="math inline">\(\mathbf{r}=\mathbf{v}t\)</span> from the center of the trap, provided that this distance is large compared to <span class="math inline">\(R_{0}\)</span>, the initial radius of the gas. The <span class="math inline">\(t\to\infty\)</span> limit of <a href="#eq-gaussian" class="quarto-xref">Equation&nbsp;8</a> gives</p>
<p><span class="math display">\[
        |\varphi(\mathbf{r},t\to\infty)|^{2}\propto \exp\left[-\left(\frac{m R_{0}\mathbf{r}}{ t}\right)^{2}\right],
    \label{2nd_quant_TimeOfFlight}
\]</span></p>
<p>reflecting a Gaussian initial momentum distribution of width <span class="math inline">\(R_0^{-1}\)</span>. Imaging the density distribution after expansion is one of the most commonly used experimental techniques in ultracold physics, and yields information about the momentum distribution <span class="math inline">\(n(\mathbf{p})\equiv  a^\dagger_{\mathbf{p}}a^{\vphantom{\dagger}}_{\mathbf{p}}\)</span> before expansion.</p>
<p>Consider the evolution of two Gaussian wavepackets with width <span class="math inline">\(R_0\)</span> at <span class="math inline">\(t=0\)</span>, separated by a distance <span class="math inline">\(d\gg R_0\)</span></p>
<p><span class="math display">\[
    \varphi_{L,R}(\mathbf{r},t)=\frac{1}{\left(\pi R_t^{2}\right)^{3/4}}\exp\left[-\frac{\left(\mathbf{r}\pm\mathbf{d}/2\right)^2\left(1+i t/m
    R_0^2)\right)}{2R_t^2}\right],
\]</span></p>
<p>The final term of <a href="#eq-dens-int" class="quarto-xref">Equation&nbsp;7</a> is then</p>
<p><span class="math display">\[
\begin{aligned}
    \rho_{\mathrm{int}}(\mathbf{r},t)&amp;=A(\mathbf{r},t)\cos\left[\theta+\frac{\mathbf{r}
    \cdot\mathbf{d}}{mR_0^2R_t^2}t\right]\nonumber\\
    A(\mathbf{r},t)&amp;=\frac{2\sqrt{\bar N_L\bar N_R}}{\pi^{3/2}R_t^3}\exp\left(-\frac{\mathbf{r}^2+\mathbf{d}^2/4}{R_t^2}\right)
\label{int_term}
\end{aligned}
\]</span></p>
<p>The interference term therefore consists of regularly spaced fringes, with a separation at long times of <span class="math inline">\(2\pi t/md\)</span>.</p>
<p>Now we imagine doing the same thing with two condensates of fixed particle number, which bear no phase relation to one another. The system is described by the product state (often called a <strong>Fock state</strong> in this context)</p>
<p><span class="math display">\[
    \lvert{N_L,N_R}\rangle\equiv\frac{1}{\sqrt{N_L! N_R!}}\left(a^\dagger_L\right)^{N_L}\left(a^\dagger_R\right)^{N_R}\lvert{\text{VAC}}\rangle.
\]</span></p>
<p>Computing the density in the same way yields</p>
<p><span class="math display">\[
    \rho_1(\mathbf{r},t)=N_L|\varphi_L(\mathbf{r},t)|^2+N_R|\varphi_R(\mathbf{r},t)|^2,
\label{dens_fock}  
\]</span></p>
<p>which differs from the previous result by the absence of the interference term.</p>
<p>This is not the end of the story, however. When we look at an absorption image of the gas, we are not looking at an <em>expectation value</em> of <span class="math inline">\(\rho(\mathbf{r})\)</span> but rather the measured value of some observable(s) <span class="math inline">\(\rho(\mathbf{r})\)</span>. The expectation value just tells us the result we would expect to get if we repeated the same experiment many times and averaged the result. We get more information by thinking about the correlation function of the density at two different points.</p>
<p>An application of our result <a href="#eq-rho2-result" class="quarto-xref">Equation&nbsp;5</a> for the density correlations gives</p>
<p><span id="eq-dens-corr"><span class="math display">\[
\begin{aligned}
    \rho_2(\mathbf{r},\mathbf{r}')&amp;=\rho_1(\mathbf{r})\rho_1(\mathbf{r}')
    +N_LN_{R}\varphi_L^*(\mathbf{r})\varphi_R^*(\mathbf{r}')\varphi_L(\mathbf{r}')\varphi_R(\mathbf{r}) \nonumber\\
    &amp;\qquad+N_{L}N_R\varphi_R^*(\mathbf{r})\varphi_L^*(\mathbf{r}')
    \varphi_R(\mathbf{r}')\varphi_L(\mathbf{r}).
\end{aligned}
\tag{9}\]</span></span></p>
<p>We see that the second line contains interference fringes, with the same spacing as before. The correlation function gives the relative probability of finding an atom at <span class="math inline">\(\mathbf{r}'\)</span> if there is one at <span class="math inline">\(\mathbf{r}\)</span>. We conclude that in each measurement of the density, fringes are present but with a phase that varies between measurements, even if the samples are identically prepared.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/AndrewsFringes.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption>Fringes observed by interfering two Bose condensates (Source: <span class="citation" data-cites="andrews1997observation">Andrews et al. (<a href="#ref-andrews1997observation" role="doc-biblioref">1997</a>)</span>)</figcaption>
</figure>
</div>
<p>The rather surprising implication is that predictions for measured quantities for a system in a Fock state are the same as in a relative phase state, but with a subsequent averaging over the phase.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Check
</div>
</div>
<div class="callout-body-container callout-body">
<p>Prove this by showing that the density matrix</p>
<p><span class="math display">\[
\rho=\int_0^{2\pi}\frac{d\theta}{2\pi}\lvert{\bar N_L,\bar N_R}\rangle_\theta\langle{\bar N_R,\bar N_L}\rvert_\theta
\]</span></p>
<p>coincides with that of a mixture of Fock states with binomial distribution of atoms into states <span class="math inline">\(\varphi_{L}\)</span>, <span class="math inline">\(\varphi_{r}\)</span>. At large <span class="math inline">\(N\)</span> this distribution becomes sharply peaked at occupations <span class="math inline">\(\bar N_L\)</span>, <span class="math inline">\(\bar N_R\)</span>.</p>
</div>
</div>
<p>The interference of two independent condensates was observed in 1997 in <span class="citation" data-cites="andrews1997observation">Andrews et al. (<a href="#ref-andrews1997observation" role="doc-biblioref">1997</a>)</span>. The related question of whether two independent light sources give rise to interference was discussed much earlier in <span class="citation" data-cites="magyar1963interference">Magyar and Mandel (<a href="#ref-magyar1963interference" role="doc-biblioref">1963</a>)</span>. The occurrence of interference fringes in a correlation function does not depend upon Bose condensation, although the phenomenon is very striking in this case because the fluctuations are parametrically as large as the <span class="math inline">\(\rho_1(\mathbf{r})\rho_1(\mathbf{r}')\)</span> term in <a href="#eq-dens-corr" class="quarto-xref">Equation&nbsp;9</a>. The general phenomenon is known as the <strong>Hanbury Brown and Twiss effect</strong>, which is the work of two people (not three): Robert Hanbury Brown and Richard Q. Twiss. For the history and early applications of this effect, see <span class="citation" data-cites="baym1999physics">Baym (<a href="#ref-baym1999physics" role="doc-biblioref">1999</a>)</span> and <span class="citation" data-cites="kleppner2008hanbury">Kleppner (<a href="#ref-kleppner2008hanbury" role="doc-biblioref">2008</a>)</span>.</p>
</section>
</section>
<section id="hartreefock-theory" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="hartreefock-theory"><span class="header-section-number">2</span> Hartree–Fock Theory</h2>
<p>We now apply these ideas to the approximate calculation of the energy of an interacting many body system.</p>
<section id="the-hartree-and-fock-potentials" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="the-hartree-and-fock-potentials"><span class="header-section-number">2.1</span> The Hartree and Fock Potentials</h3>
<p>Recall from last time that a two body interaction has the form</p>
<p><span class="math display">\[
\hat H_\text{int.} = \sum_{j&lt;k} U(\mathbf{r}_j-\mathbf{r}_k)=\frac{1}{2}\int d\mathbf{r}_1 d\mathbf{r}_2\, U(\mathbf{r}_1-\mathbf{r}_2)\psi^\dagger(\mathbf{r}_1)\psi^\dagger(\mathbf{r}_2)\psi^{\vphantom{\dagger}}(\mathbf{r}_2)\psi^{\vphantom{\dagger}}(\mathbf{r}_1).
\]</span></p>
<p>Since</p>
<p><span class="math display">\[
\sum_{j&lt;k} U(\mathbf{r}_j-\mathbf{r}_k) = \frac{1}{2}\int \sum_{j\neq k}\delta(\mathbf{r}_1-\mathbf{r}_j)\delta(\mathbf{r}_2-\mathbf{r}_k)U(\mathbf{r}_1-\mathbf{r}_2) d\mathbf{r}_1 d\mathbf{r}_2,
\]</span></p>
<p>we can immediately write down the expectation value of the interaction energy in a product state</p>
<p><span class="math display">\[
\begin{aligned}
    \label{2nd_quant_HartreeFock}
    \langle \hat V\rangle &amp;= \overbrace{\frac{1}{2}\int d\mathbf{r}\, d\mathbf{r}'\, \rho_1(\mathbf{r}) U(\mathbf{r}-\mathbf{r}')\rho_1(\mathbf{r}')}^{\equiv E_\text{Hartree}} \nonumber\\
    &amp;\qquad\overbrace{\pm \frac{1}{2}\int d\mathbf{r}\, d\mathbf{r}'\,  U(\mathbf{r}-\mathbf{r}')g(\mathbf{r},\mathbf{r}')g(\mathbf{r}',\mathbf{r})}^{\equiv E_\text{Fock}}.
\end{aligned}
\]</span></p>
<p>The two terms are known as the <strong>Hartree</strong> and <strong>Fock</strong> (or <strong>exchange</strong>) contributions, respectively. This expression lies at the core of the variational <strong>Hartree–Fock method</strong> for many body systems, which approximates the ground state by a product state. The Hartree term looks completely reasonable, while the Fock potential doesn’t look like a potential at all, and reflects the non-classical correlations.</p>
</section>
<section id="hartreefock-for-the-electron-gas" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="hartreefock-for-the-electron-gas"><span class="header-section-number">2.2</span> Hartree–Fock for the Electron Gas</h3>
<p>How does the Hartree–Fock picture change when we have spin? Let’s consider a system of spin-1/2 fermions. We can describe such a system in terms of field operators <span class="math inline">\(\psi^{\vphantom{\dagger}}_\sigma(\mathbf{r})\)</span>, <span class="math inline">\(\psi^\dagger_\sigma(\mathbf{r}')\)</span> satisfying the canonical anticommutation relations</p>
<p><span class="math display">\[
\begin{gathered}
    \left\{\psi^{\vphantom{\dagger}}_{\sigma_1}(\mathbf{r}_1),\psi^\dagger_{\sigma_2}(\mathbf{r}_2)\right\}=\delta_{\sigma_1\sigma_2}\delta(\mathbf{r}_1-\mathbf{r}_2)\nonumber\\
    \left\{\psi^{\vphantom{\dagger}}_{\sigma_1}(\mathbf{r}_1),\psi^{\vphantom{\dagger}}_{\sigma_2}(\mathbf{r}_2)\right\}=\left\{\psi^\dagger_{\sigma_1}(\mathbf{r}_1),\psi^\dagger_{\sigma_2}(\mathbf{r}_2)\right\}=0.
    \label{2nd_quant_PositionRelationsAnti}
\end{gathered}
\]</span></p>
<p>The density matrix is a matrix in spin space as well as real space</p>
<p><span class="math display">\[
g_{\sigma_1\sigma_2}(\mathbf{r}_1,\mathbf{r}_2) = \langle{\Psi}\rvert \psi^\dagger_{\sigma_1}(\mathbf{r}_1)\psi^{\vphantom{\dagger}}_{\sigma_2}(\mathbf{r}_2) \lvert \Psi \rangle.
\]</span></p>
<p>From <span class="math inline">\(g_{\sigma_1\sigma_2}(\mathbf{r}_1,\mathbf{r}_2)\)</span> we can extract the spin density as well the density</p>
<p><span class="math display">\[
\mathbf{\rho}(\mathbf{r}) = \mathrm{tr}\left[g(\mathbf{r},\mathbf{r})\right],\quad \mathbf{s}(\mathbf{r}) = \frac{1}{2}\mathrm{tr}\left[\boldsymbol{\sigma}g(\mathbf{r},\mathbf{r})\right].
\]</span></p>
<p>(I’ve dropped the subscript from <span class="math inline">\(\rho_1(\mathbf{r})\)</span> here.) An spin-independent interaction potential is described by a Hamiltonian of the form</p>
<p><span class="math display">\[
\hat H_\text{int.} = \frac{1}{2}\sum_{\sigma_1,\sigma_2}\int d\mathbf{r}_1 d\mathbf{r}_2\, U(\mathbf{r}_1-\mathbf{r}_2)\psi^\dagger_{\sigma_1}(\mathbf{r}_1)\psi^\dagger_{\sigma_2}(\mathbf{r}_2)\psi^{\vphantom{\dagger}}_{\sigma_2}(\mathbf{r}_2)\psi^{\vphantom{\dagger}}_{\sigma_1}(\mathbf{r}_1).
\]</span></p>
<p>The Hartree–Fock energy is then</p>
<p><span class="math display">\[
\begin{aligned}
    \langle \hat H_\text{int.}\rangle &amp;=\frac{1}{2}\int d\mathbf{r}\, d\mathbf{r}'\, \rho(\mathbf{r}) U(\mathbf{r}-\mathbf{r}')\rho(\mathbf{r}')\nonumber\\
    &amp;- \frac{1}{2}\int d\mathbf{r}\, d\mathbf{r}'\,  U(\mathbf{r}-\mathbf{r}')\mathrm{tr}\left[g(\mathbf{r},\mathbf{r}')g(\mathbf{r}',\mathbf{r})\right].
  \label{2nd_quant_HFSpin}
\end{aligned}
\]</span></p>
<p>The Fock term can be rewritten in a more useful way using the identity</p>
<p><span id="eq-pauli-ident"><span class="math display">\[
\delta_{ab}\delta_{cd} = \frac{1}{2}\left[\boldsymbol{\sigma}_{a c}\cdot \boldsymbol{\sigma}_{d b} + \delta_{ac}\delta_{db}\right].
\tag{10}\]</span></span></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Check
</div>
</div>
<div class="callout-body-container callout-body">
<p>One way to understand <a href="#eq-pauli-ident" class="quarto-xref">Equation&nbsp;10</a> is to to think of the two Pauli matrices as acting on two spin 1/2s (as we did in <a href="../notes/spin-models.html">Lecture 4</a>, in which case we can work in the basis <span class="math inline">\(\lvert{s_1}\rangle\lvert{s_2}\rangle\)</span> and we have</p>
<p><span class="math display">\[
\boldsymbol{\sigma}_1\cdot \boldsymbol{\sigma}_2+ \mathbb{1}_1\mathbb{1}_2 = 2\begin{pmatrix}
1 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1
\end{pmatrix}.
\]</span> The matrix elements of the right hand side are then <span class="math inline">\(2\delta_{s_1,s_2'}\delta_{s_2,s_1'}\)</span>.</p>
</div>
</div>
<p>which gives</p>
<p><span class="math display">\[
\begin{aligned}
E_{\text{Fock}} &amp;=-\frac{1}{4} \int d\mathbf{r}\, d\mathbf{r}'\,  U(\mathbf{r}-\mathbf{r}')\mathrm{tr}\left[g(\mathbf{r},\mathbf{r}')\right]\mathrm{tr}\left[g(\mathbf{r}',\mathbf{r})\right]\nonumber\\&amp;-\frac{1}{4}\int d\mathbf{r}\, d\mathbf{r}'\,  U(\mathbf{r}-\mathbf{r}')\mathrm{tr}\left[\boldsymbol{\sigma}g(\mathbf{r},\mathbf{r}')\right]\cdot\mathrm{tr}\left[\boldsymbol{\sigma}g(\mathbf{r}',\mathbf{r})\right].
\end{aligned}
\]</span></p>
<p>Suppose we had a <span class="math inline">\(\delta\)</span>-function interaction <span class="math inline">\(U(\mathbf{r})=V_0 \delta(\mathbf{r})\)</span>. Then the Fock energy can be written</p>
<p><span class="math display">\[
\begin{aligned}
E_{\text{Fock}} =-\frac{V_0}{4} \int d\mathbf{r}\, \rho(\mathbf{r})^2-V_0\int d\mathbf{r}\, \mathbf{s}(\mathbf{r})\cdot\mathbf{s}(\mathbf{r})
\end{aligned}
\]</span></p>
<p>The second term favours ferromagnetism for repulsive interactions. The physical origin is the same as the Hund’s rule coupling in atoms: fermions in different spin states can sit at the same spatial location, while those in the same spin state must be in different locations. For repulsive interactions occupying the same spin state is energetically favourable.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Check
</div>
</div>
<div class="callout-body-container callout-body">
<p>This is most succintly put by the formula</p>
<p><span class="math display">\[
\rho_2(\mathbf{r},\mathbf{r}) = \frac{1}{2}\rho(\mathbf{r})^2 - 2\mathbf{s}(\mathbf{r})\cdot\mathbf{s}(\mathbf{r})
\]</span></p>
</div>
</div>
<p>The Hartree–Fock energy forms the basis of a variational method using product states as variational wavefunctions. For a Hamiltonian with translational invariance, like</p>
<p><span id="eq-H-2nd"><span class="math display">\[
H = \int d\mathbf{r}\frac{1}{2m}\nabla\psi^\dagger\cdot\nabla\psi^{\vphantom{\dagger}}+ \frac{1}{2}\int d\mathbf{r}d\mathbf{r}' U(\mathbf{r}-\mathbf{r}')\psi^\dagger(\mathbf{r})\psi^\dagger(\mathbf{r}')\psi^{\vphantom{\dagger}}(\mathbf{r}')\psi^{\vphantom{\dagger}}(\mathbf{r}),
\tag{11}\]</span></span></p>
<p>this is not too bad, as we are guaranteed to be working with plane wave single particle states. Then the only variational parameters are the occupancies of these states: we’ll meet an example in the next section. If translational symmetry is broken by introducing a potential <span class="math inline">\(U(\mathbf{r})\)</span> into the single particle part of <a href="#eq-H-2nd" class="quarto-xref">Equation&nbsp;11</a>, say, the situation is more complicated. We may be tempted to use single particle states that are the eigenstates of the single particle part of the Hamiltonian, but there is no real justification for this, and one has to allow the states, as well as the occupancies, to vary.</p>
</section>
<section id="stoner-criterion-for-ferromagnetism" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="stoner-criterion-for-ferromagnetism"><span class="header-section-number">2.3</span> Stoner Criterion for Ferromagnetism</h3>
<p>Let us try to put a bit more flesh on the idea that repulsive interactions favour ferromagnetism in fermionic systems. We will continue to use the model interaction <span class="math inline">\(U(\mathbf{r})=V_0\delta(\mathbf{r})\)</span> that we introduced in the previous section. Of course, this isn’t a realistic interaction between electrons in a metal, say, but as we’ll see in <a href="jellium.qmd">Lecture 11</a>, the long-ranged Coulomb interaction is screened and becomes finite-ranged. Thus our model is not a bad approximation to the <em>effective</em> interaction between electrons in a metal.</p>
<p>Polarizing the spins in a Fermi gas is not without cost (otherwise everything would be ferromagnetic!): there is a price to pay in increased kinetic energy. To understand why this is so, consider the ground state kinetic energy of <span class="math inline">\(N\)</span> (spinless) fermions in three dimensions, obtained from</p>
<p><span class="math display">\[
\begin{aligned}
N = \sum_{|\mathbf{k}|&lt;k_\text{F}} 1 &amp;\longrightarrow L^3 \int_{|\mathbf{k}|&lt;k_\text{F}} \frac{d\mathbf{k}}{(2\pi)^3} = \frac{k_\text{F}^3 L^3}{6\pi^2} \nonumber\\
E_\text{kin} = \sum_{|\mathbf{k}|&lt;k_\text{F}} \frac{\mathbf{k}^2}{2m} &amp;\longrightarrow L^3 \int_{|\mathbf{k}|&lt;k_\text{F}} \frac{d\mathbf{k}}{(2\pi)^3} \frac{\mathbf{k}^2}{2m}\\
&amp;= \frac{k_\text{F}^5 L^3}{20\pi^2 m} = L^3 \frac{3}{10m}(6\pi^2)^{2/3} n^{5/3},\nonumber
\end{aligned}
\]</span></p>
<p>(The assumption of a quadratic dispersion is not important here. More generally, we fill a band structure.) where <span class="math inline">\(n = \frac{N}{L^3}\)</span> is the mean density. Assuming a system of fermions with spin is now polarized in the <span class="math inline">\(z\)</span>-direction, we have differing densities <span class="math inline">\(n_{\uparrow,\downarrow}\)</span> of spin up and spin down fermions. Their total energy is</p>
<p><span class="math display">\[
E_\text{kin}(n_\uparrow,n_\downarrow) = \frac{cL^3}{m}\left(n_\uparrow^{5/3}+n_\downarrow^{5/3}\right),
\]</span></p>
<p>where <span class="math inline">\(c=\frac{3}{10}(6\pi^2)^{2/3}\)</span>. In terms of the overall density <span class="math inline">\(n=n_\uparrow+n_\downarrow\)</span> and density of spin <span class="math inline">\(\bar s = \left(n_\uparrow-n_\downarrow\right)/2\)</span>, we have</p>
<p><span class="math display">\[
E_\text{kin}(n, \bar s) = \frac{cL^3}{m}\left(\left[n/2+\bar s\right]^{5/3}+\left[n/2-\bar s\right]^{5/3}\right).
\]</span></p>
<p>Alternatively, write this in terms of the <strong>polarization</strong> <span class="math inline">\(P \equiv \frac{n_\uparrow-n_\downarrow}{n}\)</span> that varies in the range <span class="math inline">\([-1,1]\)</span> as</p>
<p><span class="math display">\[
E_\text{kin}(P) = \frac{E_\text{K}}{2}\left[(1+P)^{5/3}+(1-P)^{5/3}\right].
\]</span></p>
<p>We see that, on account of the convexity of <span class="math inline">\(x^{5/3}\)</span>, <span class="math inline">\(E^{(0)}_\text{kin}(n, \bar s)\)</span> is minimized for <span class="math inline">\(s=0\)</span>.</p>
<p>Let’s compare this with the effect of interactions. In the short-ranged model introduced above, the total Hartree–Fock energy is</p>
<p><span class="math display">\[
E_\text{HF}(n,\bar s) = \frac{V_0L^3}{2} n^2 - \frac{V_0L^3}{2} \left(n_\uparrow^2+n_\downarrow^2\right) =  \frac{V_0L^3}{2} \left(\frac{1}{2}n^2 - 2\bar s^2\right).
\]</span></p>
<p>We write this in terms of the polarization as</p>
<p><span class="math display">\[
E_\text{HF}(P) = \frac{E_V}{2}(1-P^2).
\]</span></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Check
</div>
</div>
<div class="callout-body-container callout-body">
<p>Minimize the total energy <span class="math inline">\(E(P) = E_\text{kin}(P) + E_\text{HF}(P)\)</span> to show</p>
<ol type="1">
<li>For <span class="math inline">\(E_V/E_K&lt;10/9\)</span> the ground state is non-magnetic.</li>
<li>As <span class="math inline">\(E_V/E_K\)</span> increases past <span class="math inline">\(10/9\)</span> the magnetization begins to increase.</li>
<li>At <span class="math inline">\(E_V/E_K&gt;\frac{5}{6}2^{2/3}\)</span> is the ground state is fully polarized.</li>
</ol>
</div>
</div>
<p>One shouldn’t take these numerical values too seriously given the simplicity of the model, but they illustrate the physical principles at work behind the appearance of ferromagnetism in metals.</p>
</section>
<section id="excited-state-energies" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="excited-state-energies"><span class="header-section-number">2.4</span> Excited State Energies</h3>
<p>So far we have discussed properties of the ground state only. We can, however, evaluate the Hartree–Fock energy in a product state describing an excited state of a noninteracting system. This gives the first order perturbation theory correction to the excited state energy. For concreteness we will stick with fermions for now, though the method is general.</p>
<p>If we work in a translationally invariant system, the appropriate single particle states are plane waves. We write the field operators in the plane wave basis as</p>
<p><span class="math display">\[
\begin{aligned}
    \psi^{\vphantom{\dagger}}(\mathbf{r})\equiv\frac{1}{L^{3/2}}\sum_{\mathbf{k}} \exp(i\mathbf{k}\cdot\mathbf{r})a^{\vphantom{\dagger}}_{\mathbf{k}},\nonumber\\
  \psi^\dagger(\mathbf{r})\equiv\frac{1}{L^{3/2}}\sum_{\mathbf{k}} \exp(-i\mathbf{k}\cdot\mathbf{r})a^\dagger_{\mathbf{k}},
\end{aligned}
\]</span></p>
<p>and represent the interaction potential in terms of its Fourier components</p>
<p><span class="math display">\[
U(\mathbf{r}-\mathbf{r}') = \frac{1}{L^3}\sum_\mathbf{q}\tilde U(\mathbf{q}) \exp(i\mathbf{q}\cdot[\mathbf{r}-\mathbf{r}']).
\]</span></p>
<p>The interaction Hamiltonian for spinless particles can then be written</p>
<p><span id="eq-vertex"><span class="math display">\[
\hat H_\text{int.}  = \frac{1}{2L^3} \sum_{\mathbf{k}_1+\mathbf{k}_2=\mathbf{k}_3+\mathbf{k}_4} \tilde U(\mathbf{k}_1-\mathbf{k}_4) a^\dagger_{\mathbf{k}_1}a^\dagger_{\mathbf{k}_2}a^{\vphantom{\dagger}}_{\mathbf{k}_3}a^{\vphantom{\dagger}}_{\mathbf{k}_4}.
\tag{12}\]</span></span></p>
<p>When written in this way, interaction Hamiltonians are sometimes associated with the graphical representation below, one of the ingredients of the <strong>Feynman diagram</strong> technique for performing perturbation theory calculations in field theories. The incoming lines (arrows in) represent particles being removed (in momentum states <span class="math inline">\(\mathbf{k}_3\)</span> and <span class="math inline">\(\mathbf{k}_4\)</span>) and the outgoing lines represent particles added (momenta <span class="math inline">\(\mathbf{k}_1\)</span> and <span class="math inline">\(\mathbf{k}_2\)</span>). The wiggly line represents <span class="math inline">\(\tilde V(\mathbf{q})\)</span>. The conservation of momentum at the vertices is a consequence of the translational invariance of the problem: the two integrations over <span class="math inline">\(\mathbf{r}\)</span> and <span class="math inline">\(\mathbf{r}'\)</span> give rise to two <span class="math inline">\(\delta\)</span>-functions that perform this function.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/Vertex.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption>Graphical representation of the interaction <a href="#eq-vertex" class="quarto-xref">Equation&nbsp;12</a>.</figcaption>
</figure>
</div>
<p>As we’ve already discussed, the expectation value of <a href="#eq-vertex" class="quarto-xref">Equation&nbsp;12</a> in a product state of momentum eigenstates gives two terms, with different ‘pairings’ of creation operators with annihilation operators. We can represent these two terms graphically as shown below.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/HFDiag.png" class="img-fluid figure-img"></p>
<figcaption>Graphical representation of the Hartree and Fock terms.</figcaption>
</figure>
</div>
<p>Evaluating the two contributions in terms of the occupation numbers gives</p>
<p><span class="math display">\[
\langle{\mathbf{N}}\rvert \hat H_\text{int.} \lvert \mathbf{N} \rangle = \frac{1}{2V}\tilde U(0) \sum_{\mathbf{k}_1,\mathbf{k}_2} N_{\mathbf{k}_1}N_{\mathbf{k}_2} - \frac{1}{2V} \sum_{\mathbf{k}_1,\mathbf{k}_2} \tilde U(\mathbf{k}_1-\mathbf{k}_2) N_{\mathbf{k}_1}N_{\mathbf{k}_2}
\]</span></p>
<p>While the Hartree term just depends on the total number of particles, the Fock term depends on the individual occupations. The interaction energy to add a single particle to state <span class="math inline">\(\mathbf{k}\)</span> is</p>
<p><span class="math display">\[
\Delta U_{\mathbf{k}} = \frac{\tilde U(0)}{V} \sum_{\mathbf{k}'} N_{\mathbf{k}'} - \frac{1}{V}\sum_{\mathbf{k}'} \tilde U(\mathbf{k}-\mathbf{k}') N_{\mathbf{k}'}
\]</span></p>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-andrews1997observation" class="csl-entry" role="listitem">
Andrews, MR, CG Townsend, H-J Miesner, DS Durfee, DM Kurn, and W Ketterle. 1997. <span>“Observation of Interference Between Two Bose Condensates.”</span> <em>Science</em> 275 (5300): 637–41.
</div>
<div id="ref-baym1999physics" class="csl-entry" role="listitem">
Baym, Gordon. 1999. <span>“The Physics of Hanbury Brown-Twiss Interferometry: From Stars to Nuclear Collisions to Atomic and Condensed Matter Systems.”</span> <em>Measuring The Size Of Things In The Universe: Hbt Interferometry And Heavy Ion Physics: Proceedings Of Cris’ 98</em>, 11.
</div>
<div id="ref-baym2018lectures" class="csl-entry" role="listitem">
———. 2018. <em>Lectures on Quantum Mechanics</em>. CRC Press.
</div>
<div id="ref-kleppner2008hanbury" class="csl-entry" role="listitem">
Kleppner, Daniel. 2008. <span>“Hanbury Brown’s Steamroller.”</span> <em>Physics Today</em> 61 (8): 8–9.
</div>
<div id="ref-magyar1963interference" class="csl-entry" role="listitem">
Magyar, G, and L Mandel. 1963. <span>“Interference Fringes Produced by Superposition of Two Independent Maser Light Beams.”</span> <em>Nature</em> 198 (4877): 255–56.
</div>
<div id="ref-nazarov2013advanced" class="csl-entry" role="listitem">
Nazarov, Yuli V, and Jeroen Danon. 2013. <em>Advanced Quantum Mechanics: A Practical Guide</em>. Cambridge University Press.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../notes/second-quantization.html" class="pagination-link" aria-label="A is for Annihilation">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">A is for Annihilation</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../notes/lattice-models.html" class="pagination-link" aria-label="Lattice Models">
        <span class="nav-page-text">Lattice Models</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>