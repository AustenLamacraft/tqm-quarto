<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>A is for Annihilation – Theories of Quantum Matter</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../notes/more-second-quantization.html" rel="next">
<link href="../notes/spin-models.html" rel="prev">
<link href="../favicon-32x32.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../notes/intro.html">Notes</a></li><li class="breadcrumb-item"><a href="../notes/second-quantization.html">A is for Annihilation</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Theories of Quantum Matter</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TQM Lectures 2024</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Notes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/many-body-wavefunctions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Many Body Wavefunctions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/quantum-hall-effect.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quantum Hall Effect</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/elastic-chain.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Elastic Chain</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/spin-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spin Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/second-quantization.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">A is for Annihilation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/more-second-quantization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">B is for Bunching</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/lattice-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lattice Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/bose-gas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bose Gas</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/fermi-gas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fermi Gas</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notes/superconductivity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Superconductivity</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Slides</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../slides/many-body-wavefunctions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Many Body Wavefunctions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../slides/quantum-hall-effect.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quantum Hall Effect</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../slides/elastic-chain.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Elastic Chain</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../slides/spin-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spin Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../slides/second-quantization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A is for Annihilation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../slides/more-second-quantization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">B is for Bunching</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../slides/lattice-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lattice Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../slides/bose-gas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bose Gas</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../slides/fermi-gas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fermi Gas</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../slides/superconductivity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Superconductivity</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Problem Sets</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../problem-sets/problem-set-1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problem Set 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../problem-sets/problem-set-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problem Set 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../problem-sets/problem-set-3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Problem Set 3</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../past-papers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Past Papers</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#creation-and-annihilation-operators" id="toc-creation-and-annihilation-operators" class="nav-link active" data-scroll-target="#creation-and-annihilation-operators"><span class="header-section-number">1</span> Creation and Annihilation Operators</a>
  <ul class="collapse">
  <li><a href="#recap-product-states" id="toc-recap-product-states" class="nav-link" data-scroll-target="#recap-product-states"><span class="header-section-number">1.1</span> Recap: Product States</a></li>
  <li><a href="#creation-and-annihilation-operators-1" id="toc-creation-and-annihilation-operators-1" class="nav-link" data-scroll-target="#creation-and-annihilation-operators-1"><span class="header-section-number">1.2</span> Creation and Annihilation Operators</a></li>
  <li><a href="#choosing-a-basis" id="toc-choosing-a-basis" class="nav-link" data-scroll-target="#choosing-a-basis"><span class="header-section-number">1.3</span> Choosing a Basis</a></li>
  <li><a href="#the-case-of-fermions" id="toc-the-case-of-fermions" class="nav-link" data-scroll-target="#the-case-of-fermions"><span class="header-section-number">1.4</span> The Case of Fermions</a></li>
  </ul></li>
  <li><a href="#discussion-how-do-avphantomdagger_alpha-and-adagger_alpha-look" id="toc-discussion-how-do-avphantomdagger_alpha-and-adagger_alpha-look" class="nav-link" data-scroll-target="#discussion-how-do-avphantomdagger_alpha-and-adagger_alpha-look"><span class="header-section-number">2</span> Discussion: How Do <span class="math inline">\(a^{\vphantom{\dagger}}_\alpha\)</span> and <span class="math inline">\(a^\dagger_\alpha\)</span> <em>Look</em>?</a></li>
  <li><a href="#representation-of-operators" id="toc-representation-of-operators" class="nav-link" data-scroll-target="#representation-of-operators"><span class="header-section-number">3</span> Representation of Operators</a>
  <ul class="collapse">
  <li><a href="#one-particle-operators" id="toc-one-particle-operators" class="nav-link" data-scroll-target="#one-particle-operators"><span class="header-section-number">3.1</span> One Particle Operators</a></li>
  <li><a href="#two-particle-operators" id="toc-two-particle-operators" class="nav-link" data-scroll-target="#two-particle-operators"><span class="header-section-number">3.2</span> Two Particle Operators</a></li>
  </ul></li>
  <li><a href="#appendix-alternative-derivation-of-one--and-two-particle-operators" id="toc-appendix-alternative-derivation-of-one--and-two-particle-operators" class="nav-link" data-scroll-target="#appendix-alternative-derivation-of-one--and-two-particle-operators"><span class="header-section-number">4</span> Appendix: Alternative Derivation of One- and Two-particle Operators</a>
  <ul class="collapse">
  <li><a href="#one-particle-operators-1" id="toc-one-particle-operators-1" class="nav-link" data-scroll-target="#one-particle-operators-1"><span class="header-section-number">4.1</span> One particle operators</a></li>
  <li><a href="#two-particle-operators-1" id="toc-two-particle-operators-1" class="nav-link" data-scroll-target="#two-particle-operators-1"><span class="header-section-number">4.2</span> Two particle operators</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../notes/intro.html">Notes</a></li><li class="breadcrumb-item"><a href="../notes/second-quantization.html">A is for Annihilation</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">A is for Annihilation</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="hidden">
<!-- See https://stackoverflow.com/questions/76398554/how-to-define-latex-macros-globally-for-a-quarto-book -->
<p><span class="math display">\[
\DeclareMathOperator{\tr}{tr}
\DeclareMathOperator{\E}{\mathbb{E}}
\]</span></p>
</div>
<p>We have seen that product states can be described in terms of their occupation numbers. We now introduce a language to describe many body states, and the operators that act on them, that is adapted to this description. This method of <strong>second quantization</strong> represents the beginning of the field theoretic description of many body systems.</p>
<p>Reading: <span class="citation" data-cites="baym2018lectures">Baym (<a href="#ref-baym2018lectures" role="doc-biblioref">2018</a>)</span>, <span class="citation" data-cites="nazarov2013advanced">Nazarov and Danon (<a href="#ref-nazarov2013advanced" role="doc-biblioref">2013</a>)</span>.</p>
<hr>
<section id="creation-and-annihilation-operators" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="creation-and-annihilation-operators"><span class="header-section-number">1</span> Creation and Annihilation Operators</h2>
<p>When we discussed the elastic chain in <a href="../notes/elastic-chain.html">Lecture 3</a>, we saw that the quanta of the normal modes of the chain could be thought of as bosons. The essence of second quantization is to turn this observation around, and formally introduce <strong>creation and annihilation operators</strong> that add and remove bosons to a system. Subsequently, we identify these operators as components of a <strong>quantum field</strong>. Whether you think of the field as a physical entity – with the bosons appearing upon quantization – or as a mathematical device for representing a system of indistinguishable particles is a question of taste. The former point of view is more common in particle physics, the latter in condensed matter.</p>
<section id="recap-product-states" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="recap-product-states"><span class="header-section-number">1.1</span> Recap: Product States</h3>
<p>Remember that in <a href="../notes/many-body-wavefunctions.html">Lecture 1</a> we saw that a normalized product state of <span class="math inline">\(N\)</span> bosons occupying orthonormal states <span class="math inline">\(\varphi_{\alpha_n}(\mathbf{r})\)</span> <span class="math inline">\(n=1,\ldots, N\)</span> is</p>
<p><span id="eq-ortho-prod"><span class="math display">\[
\Psi^{\text{S}}_{\alpha_{1}\alpha_{2}\cdots\alpha_{N}}(\mathbf{r}_1,\ldots,\mathbf{r}_N)=\sqrt{\frac{1}{N!\prod_{\alpha}N_{\alpha}!}}\sum_P\varphi_{\alpha_{1}}(\mathbf{r}_{P_1})\varphi_{\alpha_{2}}(\mathbf{r}_{P_2})\cdots\varphi_{\alpha_{N}}(\mathbf{r}_{P_N}),
\tag{1}\]</span></span></p>
<p>where the sum is over all permutations of <span class="math inline">\(N\)</span> objects. The normalization factor involves the <strong>occupation numbers</strong> <span class="math inline">\(\{N_{\alpha}\}\)</span> giving the number of particles in state <span class="math inline">\(\alpha\)</span>.</p>
<p>More generally, let’s consider the (unnormalized) symmetric product state formed from any set of single particle wavefunctions <span class="math inline">\(\psi_n(\mathbf{r})\)</span>, not necessarily orthonormal</p>
<p><span id="eq-N-prod"><span class="math display">\[
\Psi^{\text{S}}(\mathbf{r}_1,\ldots,\mathbf{r}_N) = \frac{1}{\sqrt{N!}}\sum_P\psi_1(\mathbf{r}_{P_1})\psi_{2}(\mathbf{r}_{P_2})\cdots\psi_{N}(\mathbf{r}_{P_N}).
\tag{2}\]</span></span></p>
<p>Let’s compute the inner product with another symmetric state formed from wavefunctions <span class="math inline">\(\phi_n(\mathbf{r})\)</span></p>
<p><span class="math display">\[
\Phi^{\text{S}}(\mathbf{r}_1,\ldots,\mathbf{r}_N) = \frac{1}{\sqrt{N!}}\sum_P\phi_1(\mathbf{r}_{P_1})\phi_{2}(\mathbf{r}_{P_2})\cdots\phi_{N}(\mathbf{r}_{P_N}).
\]</span></p>
<p>The result is</p>
<p><span id="eq-perm"><span class="math display">\[
\langle{\Psi}\rvert\Phi\rangle = \sum_P \prod_{n=1}^N\langle{\psi_n}\rvert\phi_{P_n}\rangle = \operatorname{perm} \langle{\psi_m}\rvert\phi_{n}\rangle,
\tag{3}\]</span></span></p>
<p>where we have introduced the <a href="https://en.wikipedia.org/wiki/Permanent">permanent</a> of the matrix <span class="math inline">\(\langle{\psi_m}\rvert\phi_{n}\rangle\)</span>, which is defined just like the determinant that we met in the case of fermions, but without the minus signs.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Check
</div>
</div>
<div class="callout-body-container callout-body">
<p>Satisfy yourself that <a href="#eq-perm" class="quarto-xref">Equation&nbsp;3</a> agrees with <a href="#eq-ortho-prod" class="quarto-xref">Equation&nbsp;1</a> in the case of orthonormal single particle wavefunctions.</p>
</div>
</div>
</section>
<section id="creation-and-annihilation-operators-1" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="creation-and-annihilation-operators-1"><span class="header-section-number">1.2</span> Creation and Annihilation Operators</h3>
<p>Our starting point is the <strong>vacuum state</strong>, which we’ll denote by <span class="math inline">\(\lvert{\text{VAC}}\rangle\)</span> to distinguish it from the ground state. The vacuum state corresponds to the state with no particles. Up to now, we have worked with many body wavefunctions having just as many arguments as we have particles, but since we are now considering a formalism in which there are states with different numbers of particles, we have to allow for that number to be zero.</p>
<p>The creation operator <span class="math inline">\(a^\dagger(\psi)\)</span> creates a particle in the single particle state <span class="math inline">\(\psi(\mathbf{r})\)</span> (the reason for introducing the adjoint operator as the creation operator will become clear: for the moment let’s just take it that it’s the adjoint of <em>something</em>.). This means we identify</p>
<p><span id="eq-1-part"><span class="math display">\[
\psi(\mathbf{r})\longleftrightarrow a^\dagger(\psi)\lvert{\text{VAC}}\rangle.
\tag{4}\]</span></span></p>
<p>More generally, if <span class="math inline">\(\lvert{\Psi}\rangle\)</span> is an <span class="math inline">\(N\)</span> particle state, <span class="math inline">\(a^\dagger(\psi)\lvert{\Psi}\rangle\)</span> is an <span class="math inline">\(N+1\)</span> particle state. Since this is orthogonal to the vacuum state</p>
<p><span class="math display">\[
\langle{\text{VAC}}\rvert a^\dagger(\psi)\lvert{\Psi}\rangle=0,
\]</span></p>
<p>for any state <span class="math inline">\(\lvert{\Psi}\rangle\)</span>. This means, taking the adjoint</p>
<p><span class="math display">\[
a^{\vphantom{\dagger}}(\psi)\lvert{\text{VAC}}\rangle=0.
\]</span></p>
<p>Evidently, <span class="math inline">\(a^\dagger(\psi)\)</span> must be linear in <span class="math inline">\(\psi\)</span></p>
<p><span class="math display">\[
a^\dagger\left(c_1\psi_1+c_2\psi_2\right) = c_1a^\dagger(\psi_1)+c_2a^\dagger(\psi_2).
\]</span></p>
<p>Generalizing <a href="#eq-1-part" class="quarto-xref">Equation&nbsp;4</a>, we represent an <span class="math inline">\(N\)</span> particle product state <a href="#eq-N-prod" class="quarto-xref">Equation&nbsp;2</a> as</p>
<p><span id="eq-N-part"><span class="math display">\[
\Psi^{\text{S}}(\mathbf{r}_1,\ldots,\mathbf{r}_N) \longleftrightarrow a^\dagger(\psi_1)\cdots a^\dagger(\psi_N)\lvert{\text{VAC}}\rangle.
\tag{5}\]</span></span></p>
<p>For this to be a symmetric wavefunction, it’s clear that we must have</p>
<p><span id="eq-ad-commute"><span class="math display">\[
\left[a^\dagger(\psi),a^\dagger(\phi)\right]=0
\tag{6}\]</span></span></p>
<p>for any states <span class="math inline">\(\psi(\mathbf{r})\)</span> and <span class="math inline">\(\phi(\mathbf{r})\)</span>. Taking the adjoint gives</p>
<p><span id="eq-a-commute"><span class="math display">\[
\left[a^{\vphantom{\dagger}}(\psi),a^{\vphantom{\dagger}}(\phi)\right]=0
\tag{7}\]</span></span></p>
<p>This isn’t the only requirement however: we need to make sure that the inner product comes out right. Evaluating the inner product between two one particle states on both sides of the correspondence <a href="#eq-1-part" class="quarto-xref">Equation&nbsp;4</a> gives</p>
<p><span class="math display">\[
\langle{\psi}\rvert\phi\rangle = \langle{\text{VAC}}\rvert a^{\vphantom{\dagger}}(\psi)a^\dagger(\phi) \lvert \text{VAC} \rangle.
\]</span></p>
<p>To be nonzero <span class="math inline">\(a^{\vphantom{\dagger}}(\psi)a^\dagger(\phi)\lvert{\text{VAC}}\rangle\)</span> must be proportional to the vacuum state, which means <span class="math inline">\(a^{\vphantom{\dagger}}(\psi)\)</span> removes a particle from the system: it is an annihilation operator. To get the right value for the inner product, we impose</p>
<p><span id="eq-ada-commute"><span class="math display">\[
\left[a^{\vphantom{\dagger}}(\psi),a^\dagger(\phi)\right] = \langle{\psi}\rvert \phi \rangle.
\tag{8}\]</span></span></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Check
</div>
</div>
<div class="callout-body-container callout-body">
<p>Show that this also reproduces <a href="#eq-perm" class="quarto-xref">Equation&nbsp;3</a>.</p>
</div>
</div>
<p><a href="#eq-ad-commute" class="quarto-xref">Equation&nbsp;6</a>, <a href="#eq-a-commute" class="quarto-xref">Equation&nbsp;7</a>, and <a href="#eq-ada-commute" class="quarto-xref">Equation&nbsp;8</a> constitute the bosonic <strong>canonical commutation relations</strong>. Via <a href="#eq-ada-commute" class="quarto-xref">Equation&nbsp;8</a>, this representation inherits the properties of the single particle Hilbert space.</p>
</section>
<section id="choosing-a-basis" class="level3" data-number="1.3">
<h3 data-number="1.3" class="anchored" data-anchor-id="choosing-a-basis"><span class="header-section-number">1.3</span> Choosing a Basis</h3>
<p>By choosing a basis for the single particle states, we choose a basis for the creation and annihilation operators. Denote an orthonormal basis by <span class="math inline">\(\varphi_\alpha(\mathbf{r})\)</span>, with the corresponding creation and annihilation operators</p>
<p><span id="eq-ccr-basis"><span class="math display">\[
a^\dagger(\varphi_\alpha)\equiv a^\dagger_\alpha,\quad a^{\vphantom{\dagger}}(\varphi_\alpha)\equiv a^{\vphantom{\dagger}}_\alpha.
\tag{9}\]</span></span></p>
<p>Then we have</p>
<p><span class="math display">\[
\begin{align}
\left[a^{\vphantom{\dagger}}_\alpha,a^{\vphantom{\dagger}}_\beta\right]=0,\quad \left[a^\dagger_\alpha,a^\dagger_\beta\right]=0,\quad \left[a^{\vphantom{\dagger}}_\alpha,a^\dagger_\beta\right] = \delta_{\alpha\beta}.
\end{align}
\]</span></p>
<p>The same relations describe the ladder operators of a set of independent harmonic oscillators, revealing a deep connection between these two systems. The state <span class="math inline">\(\Psi^{\text{S}}_{\alpha_{1}\alpha_{2}\cdots\alpha_{N}}\)</span> of <a href="#eq-ortho-prod" class="quarto-xref">Equation&nbsp;1</a> – a normalized state with <span class="math inline">\(N_\alpha\)</span> particles in state <span class="math inline">\(\alpha\)</span> – may be written</p>
<p><span id="eq-prod-correspondence"><span class="math display">\[
\Psi^{\text{S}}_{\alpha_{1}\alpha_{2}\cdots\alpha_{N}}(\mathbf{r}_1,\ldots,\mathbf{r}_N) \longleftrightarrow\lvert{\mathbf{N}}\rangle \equiv \prod_\alpha \frac{\left(a^\dagger_\alpha\right)^{N_\alpha}}{\sqrt{N_\alpha!}}\lvert{\text{VAC}}\rangle
\tag{10}\]</span></span></p>
<p>The combination <span class="math inline">\(\mathsf{N}^{\vphantom{\dagger}}_{\alpha}\equiv a^\dagger_{\alpha}a^{\vphantom{\dagger}}_{\alpha}\)</span> is called the <strong>number operator</strong> for state <span class="math inline">\(\alpha\)</span> for obvious reasons</p>
<p><span class="math display">\[
\label{2nd_quant_NOp}
    \mathsf{N}^{\vphantom{\dagger}}_{\alpha}\lvert{\mathbf{N}}\rangle=N_{\alpha}\lvert{\mathbf{N}}\rangle.
\]</span></p>
<p>From <a href="#eq-ccr-basis" class="quarto-xref">Equation&nbsp;9</a> it follows that</p>
<p><span class="math display">\[
\begin{align}
    \left[a^{\vphantom{\dagger}}_{\alpha},\mathsf{N}^{\vphantom{\dagger}}_{\alpha}\right]&amp;=a^{\vphantom{\dagger}}_{\alpha}\nonumber\\
    \left[a^\dagger_{\alpha},\mathsf{N}^{\vphantom{\dagger}}_{\alpha}\right]&amp;=-a^\dagger_{\alpha}.
  \label{2nd_quant_NaComm}
\end{align}
\]</span></p>
<p>You can think of the first of these as “count then destroy minus destroy then count”, for example.</p>
<p>Suppose we want to move to a different basis of single particle states <span class="math inline">\(\{\lvert{\tilde{\varphi}_{\alpha}}\rangle\}\)</span>, corresponding to a unitary transformation</p>
<p><span class="math display">\[
    \label{2nd_quant_BasisChange}
    \lvert{\tilde{\varphi}_{\alpha}}\rangle=\sum_{\beta} \langle{\varphi_{\beta}}\rvert \tilde{\varphi}_{\alpha} \rangle\lvert{\varphi_{\beta}}\rangle.
\]</span></p>
<p>Using our correspondence, the one particle states with the wavefunctions <span class="math inline">\(\varphi_{\alpha}(\mathbf{r})\)</span> are just <span class="math inline">\(a^\dagger_{\alpha}\lvert{\text{VAC}}\rangle\)</span>. So we see that the above basis transformation gives a new set of creation operators</p>
<p><span id="eq-basis-change"><span class="math display">\[
    \tilde{a^\dagger_{\alpha}}\equiv\sum_{\beta} \langle{\varphi_{\beta}}\rvert \tilde{\varphi}_{\alpha} \rangle a^\dagger_{\beta}.
\tag{11}\]</span></span></p>
<p>Often we will work in the basis of position eigenstates <span class="math inline">\(\{\lvert{\mathbf{r}}\rangle\}\)</span>. In this case the matrix elements of the unitary transformation are <span class="math inline">\(\langle{\varphi_{\beta}}\rvert \mathbf{r} \rangle=\varphi^{*}_{\beta}(\mathbf{r})\)</span>, just the complex conjugate of the wavefunction. Denoting the corresponding creation operator as <span class="math inline">\(\psi^\dagger(\mathbf{r})\)</span>, <a href="#eq-basis-change" class="quarto-xref">Equation&nbsp;11</a> becomes</p>
<p><span id="eq-psid-def"><span class="math display">\[
\psi^\dagger(\mathbf{r})\equiv\sum_{\beta}  \varphi^{*}_{\beta}(\mathbf{r})a^\dagger_{\beta}.
\tag{12}\]</span></span></p>
<p>Now we can see why we chose to work with the annihilation operator rather than the creation operator. The conjugate of <a href="#eq-psid-def" class="quarto-xref">Equation&nbsp;12</a> is</p>
<p><span id="eq-psi-def"><span class="math display">\[
\psi^{\vphantom{\dagger}}(\mathbf{r})\equiv\sum_{\beta}  \varphi_{\beta}(\mathbf{r})a^{\vphantom{\dagger}}_{\beta},
\tag{13}\]</span></span></p>
<p>and involves the wavefunctions <span class="math inline">\(\varphi_{\beta}(\mathbf{r})\)</span>, rather than their conjugates. The relations satisfied by these operators are</p>
<p><span id="eq-position-relations"><span class="math display">\[
\begin{gather}
    \left[\psi^{\vphantom{\dagger}}(\mathbf{r}_1),\psi^\dagger(\mathbf{r}_2)\right]=\delta(\mathbf{r}_1-\mathbf{r}_2)\nonumber\\
    \left[\psi^{\vphantom{\dagger}}(\mathbf{r}_1),\psi^{\vphantom{\dagger}}(\mathbf{r}_2)\right]=\left[\psi^\dagger(\mathbf{r}_1),\psi^\dagger(\mathbf{r}_2)\right]=0.
\end{gather}
\tag{14}\]</span></span></p>
<p>These operator-valued functions are called <strong>quantum fields</strong>. By introducing them, we have freed ourselves from many body wavefunctions. One should bear in mind that this is only a different <em>language</em> for talking about the same system: sometimes one language is better suited to the problem at hand; sometimes another.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Check
</div>
</div>
<div class="callout-body-container callout-body">
<p>If a state <span class="math inline">\(\lvert{\Psi}\rangle\)</span> has wavefunction <span class="math inline">\(\Psi(x_1,\ldots, x_N)\)</span>, show that the wavefunction of the state <span class="math inline">\(\psi^{\vphantom{\dagger}}(x)\lvert{\Psi}\rangle\)</span> is the <span class="math inline">\(N-1\)</span> particle wavefunction</p>
<p><span id="eq-freeze"><span class="math display">\[
\sqrt{N}\Psi(x,x_1,\ldots, x_{N-1})
\tag{15}\]</span></span></p>
<p>Hint: Show that this is true for a product state first.</p>
<div class="callout callout-style-simple callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Using the correspondence in <a href="#eq-N-part" class="quarto-xref">Equation&nbsp;5</a> we write the state that results from acting with <span class="math inline">\(\psi(x)\)</span> on a product state as <span class="math display">\[
\psi(x)a^\dagger(\psi_1)\cdots a^\dagger(\psi_N)\lvert{\text{VAC}}\rangle = \sum_m \psi_m(x) \prod_{n\neq m} a^\dagger(\psi_n) \lvert{\text{VAC}}\rangle
\]</span></p>
<p>where we used the commutation relation <span class="math inline">\([\psi(x),a^\dagger(\psi_n)]=\langle{x}\rvert\psi_n\rangle=\psi_n(x)\)</span>. The wavefunctions appearing on the RHS on <span class="math inline">\(N-1\)</span> particle wavefunctions with arguments <span class="math inline">\(x_1\)</span> to <span class="math inline">\(x_{N-1}\)</span>. Using <a href="#eq-N-part" class="quarto-xref">Equation&nbsp;5</a> and <a href="#eq-N-prod" class="quarto-xref">Equation&nbsp;2</a> the RHS corresponds to</p>
<p><span class="math display">\[
\begin{gather}
\frac{1}{\sqrt{(N-1)!}}\sum_m \psi_m(x) \sum_{P\in S_{N-1}} \psi_{1}(x_{P_1})\cdots \psi_{m-1}(x_{P_{m-1}})\psi_{m+1}(x_{P_{m}})\cdots\psi_{N}(x_{P_{N-1}}) \\
=\frac{1}{\sqrt{(N-1)!}}\sum_{P \in S_{N}}\psi_{1}(x_{P_1})\psi_{2}(x_{P_2})\cdots\psi_{N}(x_{P_N})
\end{gather}
\]</span></p>
<p>with <span class="math inline">\(x_N=x\)</span>, and <span class="math inline">\(S_N\)</span> denotes the set of permutations of <span class="math inline">\(N\)</span> objects (note the change from <span class="math inline">\(S_{N-1}\)</span> to <span class="math inline">\(S_N\)</span> between the two lines). But this just corresponds to applying the prescription <a href="#eq-freeze" class="quarto-xref">Equation&nbsp;15</a> to the original wavefunction <a href="#eq-N-prod" class="quarto-xref">Equation&nbsp;2</a>. Since this works for all product states, and since any state is a superposition of product states, it works more generally.</p>
</div>
</div>
</div>
</div>
</div>
<p>As an example, let our original basis be the eigenbasis of the free particle Hamiltonian <span class="math inline">\(H=\frac{\mathbf{p}^{2}}{2m}\)</span> with periodic boundary conditions</p>
<p><span class="math display">\[
\begin{align}
    \label{2nd_quant_FreeParticleStates}
    \lvert{\mathbf{k}}\rangle=\frac{\exp(i\mathbf{k}\cdot \mathbf{r})}{\sqrt{V}}, \quad \mathbf{k}=2\pi\left(\frac{n_{x}}{L_{x}},\frac{n_{y}}{L_{y}},\frac{n_{z}}{L_{z}}\right),\quad n_{x,y,z}\text{ integer},
\end{align}
\]</span></p>
<p>with <span class="math inline">\(V=L_{x}L_{y}L_{z}\)</span>. The matrix elements of the transformation between this original basis and the position basis <span class="math inline">\(\{\lvert{\mathbf{r}}\rangle\}\)</span> are <span class="math inline">\(\langle{\mathbf{k}}\rvert\mathbf{r}\rangle=\exp(-i\mathbf{k}\cdot \mathbf{r})/\sqrt{V}\)</span>, so we have</p>
<p><span class="math display">\[
    \label{2nd_quant_PositionAnnihilation}
    \psi^\dagger(\mathbf{r})\equiv\frac{1}{\sqrt{V}}\sum_{\mathbf{k}} \exp(-i\mathbf{k}\cdot\mathbf{r})a^\dagger_{\mathbf{k}},
\]</span></p>
<p>and similarly</p>
<p><span class="math display">\[
    \label{2nd_quant_PositionCreation}
    \psi^{\vphantom{\dagger}}(\mathbf{r})\equiv\frac{1}{\sqrt{V}}\sum_{\mathbf{k}} \exp(i\mathbf{k}\cdot\mathbf{r})a^{\vphantom{\dagger}}_{\mathbf{k}}.
\]</span></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Check
</div>
</div>
<div class="callout-body-container callout-body">
<p>What is the wavefunction of the two-particle state</p>
<p><span class="math display">\[
\sum_\mathbf{k}c_k a^\dagger_\mathbf{k}a^\dagger_{-\mathbf{k}}\lvert{\text{VAC}}\rangle?
\]</span></p>
</div>
</div>
</section>
<section id="the-case-of-fermions" class="level3" data-number="1.4">
<h3 data-number="1.4" class="anchored" data-anchor-id="the-case-of-fermions"><span class="header-section-number">1.4</span> The Case of Fermions</h3>
<p>We want a similar formalism for fermions, which is a bit trickier on account of those minus signs. We seek a representation of the product state</p>
<p><span class="math display">\[
\Psi^{\text{A}}(\mathbf{r}_1,\ldots,\mathbf{r}_N) = \frac{1}{\sqrt{N!}}\sum_P (-1)^P\psi_1(\mathbf{r}_{P_1})\psi_{2}(\mathbf{r}_{P_2})\cdots\psi_{N}(\mathbf{r}_{P_N}).
\label{A_NProdAnti}
\]</span></p>
<p>where <span class="math inline">\(P\)</span> is the signature of the permutation. Note that the overall sign is fixed here by the labelling of the states <span class="math inline">\(\psi_j\)</span>. If we want to make the identification</p>
<p><span id="eq-anti"><span class="math display">\[
\Psi^{\text{A}}(\mathbf{r}_1,\ldots,\mathbf{r}_N) \longleftrightarrow a^\dagger(\psi_1)\cdots a^\dagger(\psi_N)\lvert{\text{VAC}}\rangle,
\tag{16}\]</span></span></p>
<p>Then antisymmetry dictates</p>
<p><span class="math display">\[
\left\{a^\dagger(\psi),a^\dagger(\phi)\right\}=0,
\label{A_adanticommute}
\]</span></p>
<p>for any states <span class="math inline">\(\psi(\mathbf{r})\)</span> and <span class="math inline">\(\phi(\mathbf{r})\)</span>, where <span class="math inline">\(\{A,B\}\equiv AB+BA\)</span> is called the <strong>anticommutator</strong>. Similarly</p>
<p><span class="math display">\[
\left\{a^{\vphantom{\dagger}}(\psi),a^{\vphantom{\dagger}}(\phi)\right\}=0.
\label{A_aanticommute}
\]</span></p>
<p>The form of <span class="math inline">\(\left\{a^{\vphantom{\dagger}}(\psi),a^\dagger(\phi)\right\}\)</span> can be deduced from the inner product between product states</p>
<p><span class="math display">\[
\langle{\Psi}\rvert\Phi\rangle = \sum_P (-1)^P\prod_{n=1}^N\langle{\psi_n}\rvert\phi_{P_n}\rangle = \det \langle{\psi_m}\rvert\phi_{n}\rangle,
\label{A_det}
\]</span></p>
<p>which can be obtained using the RHS of <a href="#eq-anti" class="quarto-xref">Equation&nbsp;16</a> if we demand</p>
<p><span class="math display">\[
\left\{a^{\vphantom{\dagger}}(\psi),a^\dagger(\phi)\right\} = \langle{\psi}\rvert \phi \rangle.
\label{A_adaanti}
\]</span></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Check
</div>
</div>
<div class="callout-body-container callout-body">
<p>Check this.</p>
</div>
</div>
<p>Introducing field operators in the position basis as before leads to a system of operators satisfying the anticommutation relations</p>
<p><span class="math display">\[
\begin{gather}
    \left\{\psi^{\vphantom{\dagger}}(\mathbf{r}_1),\psi^\dagger(\mathbf{r}_2)\right\}=\delta(\mathbf{r}_1-\mathbf{r}_2)\nonumber\\
    \left\{\psi^{\vphantom{\dagger}}(\mathbf{r}_1),\psi^{\vphantom{\dagger}}(\mathbf{r}_2)\right\}=\left\{\psi^\dagger(\mathbf{r}_1),\psi^\dagger(\mathbf{r}_2)\right\}=0.
    \label{2nd_quant_PositionRelationsAnti}
\end{gather}
\]</span></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Check
</div>
</div>
<div class="callout-body-container callout-body">
<p>Show that in the fermionic case the wavefunction of the state <span class="math inline">\(\psi^{\vphantom{\dagger}}(x)\lvert{\Psi}\rangle\)</span> is still given by <a href="#eq-freeze" class="quarto-xref">Equation&nbsp;15</a>.</p>
</div>
</div>
</section>
</section>
<section id="discussion-how-do-avphantomdagger_alpha-and-adagger_alpha-look" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="discussion-how-do-avphantomdagger_alpha-and-adagger_alpha-look"><span class="header-section-number">2</span> Discussion: How Do <span class="math inline">\(a^{\vphantom{\dagger}}_\alpha\)</span> and <span class="math inline">\(a^\dagger_\alpha\)</span> <em>Look</em>?</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Check
</div>
</div>
<div class="callout-body-container callout-body">
<p>Think about the form that the operators <span class="math inline">\(a^{\vphantom{\dagger}}_\alpha\)</span>, <span class="math inline">\(a^\dagger_\alpha\)</span> take in the basis of product states. Start with one state <span class="math inline">\(\varphi_\alpha\)</span>. What’s the matrix form of <span class="math inline">\(a^\dagger_\alpha\)</span> in terms of states <span class="math inline">\(\lvert{N_\alpha}\rangle\)</span>? Now consider two states. Can you see how the commutation and anticommutation relations can be satisfied?</p>
</div>
</div>
</section>
<section id="representation-of-operators" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="representation-of-operators"><span class="header-section-number">3</span> Representation of Operators</h2>
<section id="one-particle-operators" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="one-particle-operators"><span class="header-section-number">3.1</span> One Particle Operators</h3>
<p>Suppose we now have some operator <span class="math inline">\(A\)</span> that acts on the single particle states. We denote the action on <span class="math inline">\(N\)</span> particle states as <span class="math inline">\(\hat A\)</span></p>
<p><span id="eq-one-particle"><span class="math display">\[
\hat A = \sum_{j=1}^N A_j,
\tag{17}\]</span></span></p>
<p>where the subscript denotes that the operator acts on the position label <span class="math inline">\(\mathbf{r}_j\)</span> of the <span class="math inline">\(j^\text{th}\)</span> particle. The example that we have met many times already is the Hamiltonian for noninteracting particles</p>
<p><span id="eq-h1"><span class="math display">\[
\hat H = \sum_{j=1}^N H_j = \sum_{j=1}^N \left[-\frac{\nabla_j^2}{2m}+V(\mathbf{r}_j)\right].
\tag{18}\]</span></span></p>
<p>Operators of this type are known as <strong>one particle operators</strong>. We want to use our creation and annihilation operators to represent these operators.</p>
<p>First, the action of the operator <span class="math inline">\(A\)</span> on one of the basis states <span class="math inline">\(\lvert{\varphi_\beta}\rangle\)</span> can be written in terms of the matrix elements <span class="math inline">\(A_{\alpha\beta}=\langle{\varphi_\alpha}\rvert A \lvert \varphi_\beta \rangle\)</span> by inserting a resolution of the identity <span class="math inline">\(\sum_\alpha \lvert{\alpha}\rangle\langle{\alpha}\rvert=1\)</span> on the right <span class="math display">\[
A\lvert{\varphi_\beta}\rangle = \sum_{\alpha} \lvert{\varphi_\alpha}\rangle\langle{\varphi_\alpha}\rvert A \lvert \varphi_\beta \rangle = \sum_\alpha A_{\alpha\beta}\lvert{\varphi_\alpha}\rangle.
\]</span></p>
<p>The same thing may be expressed slightly differently by inserting resolutions of the identity on the left <em>and</em> right <span class="math display">\[
A= \sum_{\alpha\beta} \lvert{\varphi_\alpha}\rangle\langle{\varphi_\alpha}\rvert A \lvert \varphi_\beta \rangle\langle{\varphi_\beta}\rvert = \sum_{\alpha\beta} A_{\alpha\beta}\lvert{\varphi_\alpha}\rangle\langle{\varphi_\beta}\rvert.
\]</span></p>
<p>Therefore, the action of <span class="math inline">\(\hat A\)</span> on the product state <span class="math inline">\(\lvert{\Psi^{\text{S}}_{\alpha_{1}\alpha_{2}\cdots\alpha_{N}}}\rangle\)</span> is <span id="eq-A-act"><span class="math display">\[
\hat A \lvert{\Psi^{\text{S}}_{\beta_{1}\beta_{2}\cdots\beta_{N}}}\rangle = \sum_\alpha \left[A_{\alpha\beta_1}\lvert{\Psi^{\text{S}}_{\alpha\beta_{2}\cdots\beta_{N}}}\rangle +A_{\alpha\beta_2}\lvert{\Psi^{\text{S}}_{\beta_1\alpha\cdots\beta_{N}}}\rangle+\cdots A_{\alpha\beta_N}\lvert{\Psi^{\text{S}}_{\beta_1\beta_{2}\cdots\alpha}}\rangle\right]
\tag{19}\]</span></span></p>
<p>Now we argue that the same job is done by</p>
<p><span class="math display">\[
\hat A = \sum_{\alpha\beta}A_{\alpha\beta}a^\dagger_\alpha a^{\vphantom{\dagger}}_\beta
\]</span></p>
<p>acting on the state <span class="math inline">\(\lvert{\mathbf{N}}\rangle\)</span>. Indeed, we have</p>
<p><span id="eq-bilinear"><span class="math display">\[
\left[a^\dagger_\alpha a^{\vphantom{\dagger}}_\beta,a^\dagger_\gamma\right]=a^\dagger_\alpha\delta_{\beta\gamma}
\tag{20}\]</span></span></p>
<p>By commuting <span class="math inline">\(a^\dagger_\alpha a^{\vphantom{\dagger}}_\beta\)</span> though each of the creation operators in</p>
<p><span class="math display">\[
\lvert{\mathbf{N}}\rangle \equiv \prod_\alpha \frac{\left(a^\dagger_\alpha\right)^{N_\alpha}}{\sqrt{N_\alpha!}}\lvert{\text{VAC}}\rangle,
\]</span></p>
<p>we reproduce the action <a href="#eq-A-act" class="quarto-xref">Equation&nbsp;19</a>. As a simple example,</p>
<p><span class="math display">\[
\begin{align}
    \label{2nd_quant_}
    \mathop{\hat A}a^\dagger_{\beta}\lvert{\text{VAC}}\rangle&amp;=\left(\left[\mathop{\hat A},a^\dagger_{\beta}\right]+a^\dagger_{\beta}\mathop{\hat A}\right)\lvert{\text{VAC}}\rangle\nonumber\\
                            &amp;=\sum_{\alpha} A_{\alpha \beta} a^\dagger_{\alpha}\lvert{\text{VAC}}\rangle.
\end{align}
\]</span></p>
<p>The second quantized form of <span class="math inline">\(\hat A\)</span> allows us to find the matrix element <span class="math inline">\(\langle{\mathbf{N}}\rvert \hat A \lvert \mathbf{N'} \rangle\)</span> between product states made of orthonormal single particle states. This vanishes unless <span class="math inline">\(\mathbf{N}\)</span> and <span class="math inline">\(\mathbf{N'}\)</span> differ by the movement of of one particle. If <span class="math inline">\(N_\beta = N'_\beta-1\)</span> and <span class="math inline">\(N_\alpha = N'_\alpha+1\)</span> we have</p>
<p><span id="eq-Aab"><span class="math display">\[
\langle{\mathbf{N}}\rvert \hat A \lvert \mathbf{N'} \rangle = A_{\alpha\beta} \sqrt{N_\alpha N'_\beta}.
\tag{21}\]</span></span></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Check
</div>
</div>
<div class="callout-body-container callout-body">
<p>This formula is not so easy to work out in the first quantized representation. Try it!</p>
</div>
</div>
<p>We worked this out for the bosonic case. However, you can check that <a href="#eq-bilinear" class="quarto-xref">Equation&nbsp;20</a>, the basic relation that makes it all work, is also valid for fermions (as a commutation relation, note!). So <span class="math inline">\(\hat A\)</span> has the same form for fermions.</p>
<p>Notice that <span class="math inline">\(\mathop{\hat A}\)</span> <em>looks</em> formally like the expectation value of <span class="math inline">\(\mathop{A}\)</span> in a single particle state <span class="math inline">\(\sum_{\alpha}a_{\alpha}\lvert{\varphi_{\alpha}}\rangle\)</span>. The difference, of course, is that the <span class="math inline">\(a_{\alpha}\)</span> in <span class="math inline">\(\mathop{\hat A}\)</span> are operators, so that the order is important, while those in the preceding expression are amplitudes. The replacement of amplitudes, or wavefunctions, by operators is the origin of the rather clumsy name <strong>second quantization</strong>, which is traditionally introduced with the caveat that what we are doing is not in any way ‘more quantum’ than before.</p>
<p>To repeat the above prescription for emphasis: <em>A one particle operator <span class="math inline">\(\mathop{\hat A}\)</span> has a second quantized representation formally identical to the expectation value of its single particle counterpart <span class="math inline">\(\mathop{A}\)</span></em>.</p>
<p>This probably all looks a bit abstract, so let’s turn to a one particle operator that we have already met, namely the noninteracting Hamiltonian in <a href="#eq-h1" class="quarto-xref">Equation&nbsp;18</a>. According to the above prescription, this should have the second quantized form</p>
<p><span class="math display">\[
    \label{2nd_quant_H2ndQ}
    \mathop{\hat H} \equiv \sum_{\alpha,\beta}\langle{\varphi_{\alpha}}\rvert \mathop{H} \lvert \varphi_{\beta} \rangle a^\dagger_{\alpha}a^{\vphantom{\dagger}}_{\beta},
\]</span></p>
<p>where <span class="math inline">\(H\)</span> is the single particle Hamiltonian <span class="math inline">\(H=-\frac{1}{2m}\nabla_{i}^{2}+V(\mathbf{r_{i}})\)</span>. This takes on a very simple form if the basis <span class="math inline">\(\lvert{\varphi_{\alpha}}\rangle\)</span> is just the eigenbasis of this Hamiltonian, in which case <span class="math inline">\(\langle{\varphi_{\alpha}}\rvert \mathop{H} \lvert \varphi_{\beta} \rangle=E_{\alpha}\delta_{\alpha \beta}\)</span> and</p>
<p><span id="eq-N-rep"><span class="math display">\[
\begin{align}
    \mathop{\hat H} \equiv \sum_{\alpha} E_{\alpha} a^\dagger_{\alpha}a^{\vphantom{\dagger}}_{\alpha}=\sum_{\alpha} E_{\alpha} \mathsf{N}^{\vphantom{\dagger}}_{\alpha}.
\end{align}
\tag{22}\]</span></span></p>
<p>Evidently this is correct: the eigenstates of this operator are just the <span class="math inline">\(N\)</span> particle basis states <span class="math inline">\(\lvert{\Psi^{S/A}_{\alpha_{1}\alpha_{2}\cdots \alpha_{N}}}\rangle\)</span>, with eigenvalues <span class="math inline">\(\sum_\alpha N_\alpha E_\alpha\)</span>.</p>
<p>Alternatively, we can look at things in the position basis. By recalling how the expectation value of the Hamiltonian looks in this basis, we come up with</p>
<p><span id="eq-h-pos"><span class="math display">\[
\begin{align}
    \mathop{\hat H}&amp;=\int d\mathbf{r}\left[-\frac{1}{2m}\psi^\dagger(\mathbf{r})\nabla^{2}\psi^{\vphantom{\dagger}}(\mathbf{r})+V(\mathbf{r})\psi^\dagger(\mathbf{r})\psi^{\vphantom{\dagger}}(\mathbf{r})\right]\nonumber\\
                    &amp;=\int d\mathbf{r}\left[\frac{1}{2m}\nabla\psi^\dagger(\mathbf{r})\cdot\nabla\psi^{\vphantom{\dagger}}(\mathbf{r})+V(\mathbf{r})\psi^\dagger(\mathbf{r})\psi^{\vphantom{\dagger}}(\mathbf{r})\right],
\end{align}
\tag{23}\]</span></span></p>
<p>where in the second line we have integrated by parts, assuming that boundary terms at infinity vanish. The equality of <a href="#eq-h-pos" class="quarto-xref">Equation&nbsp;23</a> and <a href="#eq-N-rep" class="quarto-xref">Equation&nbsp;22</a> may be seen by using <a href="#eq-psi-def" class="quarto-xref">Equation&nbsp;13</a>.</p>
<p>The Heisenberg equation of motion corresponding to <a href="#eq-h-pos" class="quarto-xref">Equation&nbsp;23</a> is</p>
<p><span class="math display">\[
\begin{equation}
    \label{2nd_quant_HeomFree}
    \begin{split}
    i\partial_{t}\psi^{\vphantom{\dagger}}(\mathbf{r},t) &amp;= -\left[\mathop{\hat H},\psi^{\vphantom{\dagger}}(\mathbf{r},t)\right]\\
    &amp;= -\frac{1}{2m}\nabla^{2}\psi^{\vphantom{\dagger}}(\mathbf{r},t)+V(\mathbf{r})\psi^{\vphantom{\dagger}}(\mathbf{r},t),
    \end{split}
\end{equation}
\]</span></p>
<p>which is just the time dependent Schrödinger equation!</p>
<p>As a second example, consider the particle density. This is not something that one encounters very often in few particle quantum mechanics, but is obviously an observable of interest in a extended system of many particles. The one particle operator for the density at <span class="math inline">\(\mathbf{x}\)</span> is</p>
<p><span class="math display">\[
    \label{2nd_quant_spDens}
    \rho(\mathbf{x})\equiv\delta(\mathbf{x}-\mathbf{r}).
\]</span></p>
<p>This may look like a rather strange definition, but its expectation value on a single particle state <span class="math inline">\(\varphi(\mathbf{r})\)</span> is just <span class="math inline">\(\rho(\mathbf{x})=\lvert{\varphi(\mathbf{x})}\rvert^{2}\)</span>, which is just the probability to find the particle at <span class="math inline">\(\mathbf{x}\)</span>. Following our prescription, the second quantized form of the operator is then</p>
<p><span class="math display">\[
    \label{2nd_quant_2ndQDens}
    \hat\rho(\mathbf{x})\equiv\psi^\dagger(\mathbf{x})\psi^{\vphantom{\dagger}}(\mathbf{x}).
\]</span></p>
<p>As a check, integrating over position should give the total number of particles</p>
<p><span class="math display">\[
    \label{2nd_quant_DensIntegral}
    \hat N=\int d\mathbf{x}\, \psi^\dagger(\mathbf{x})\psi^{\vphantom{\dagger}}(\mathbf{x})=\sum_{\alpha} a^\dagger_{\alpha}a^{\vphantom{\dagger}}_{a}=\sum_{\alpha}\mathsf{N}^{\vphantom{\dagger}}_{\alpha},
\]</span></p>
<p>as it does! Another useful thing to know is the expectation value of the density on a basis state <span class="math inline">\(\lvert{N_{0},N_{1}\ldots}\rangle\)</span></p>
<p><span class="math display">\[
    \label{2nd_quant_DensityExp}
    \langle{N_{0},N_{1}\ldots}\rvert  \hat\rho(\mathbf{r}) \lvert N_{0},N_{1}\ldots \rangle = \sum_{\alpha} N_{\alpha}\left|\varphi_{\alpha}(\mathbf{r})\right|^{2}.
\]</span></p>
<p>which is most easily proved by substituting the representation <a href="#eq-psi-def" class="quarto-xref">Equation&nbsp;13</a>. This seems like a very reasonable generalization of the single particle result: the density is given by sum of the probability densities in each of the constituent single particle state, weighted by the occupancy of the state. Note that the symmetry of the states played no role here.</p>
<p>As a final example of a one particle operator, the particle current has the second quantized form</p>
<p><span class="math display">\[
    \label{2nd_quant_current}
    \hat{\mathbf{j}}(\mathbf{r})=-i\frac{1}{2m}\left[\psi^\dagger(\mathbf{r})\left(\nabla\psi^{\vphantom{\dagger}}(\mathbf{r})\right)-\left(\nabla\psi^\dagger(\mathbf{r})\right)\psi^{\vphantom{\dagger}}(\mathbf{r})\right].
\]</span></p>
<p>Often we consider the Fourier components of the density or current</p>
<p><span class="math display">\[
\begin{align}
    \label{2nd_quant_FourierComp}
    \hat\rho_{\mathbf{q}}\equiv\int d\mathbf{r}\, \hat\rho(\mathbf{r})e^{-i\mathbf{q}\cdot \mathbf{r}}=\sum_{\mathbf{k}} a^\dagger_{\mathbf{k}-\mathbf{q}/2}a^{\vphantom{\dagger}}_{\mathbf{k}+\mathbf{q}/2}\nonumber\\
    \hat{\mathbf{j}}_{\mathbf{q}}\equiv\int d\mathbf{r}\, \hat{\mathbf{j}}(\mathbf{r})e^{-i\mathbf{q}\cdot \mathbf{r}}=\sum_{\mathbf{k}} \frac{\mathbf{k}}{m}a^\dagger_{\mathbf{k}-\mathbf{q}/2}a^{\vphantom{\dagger}}_{\mathbf{k}+\mathbf{q}/2}.
\end{align}
\]</span></p>
<p>The <span class="math inline">\(\mathbf{q}=0\)</span> modes are just the total particle number and <span class="math inline">\(\frac{1}{m}\)</span> times the total momentum, respectively.</p>
<p>In <a href="[ref []{.quarto-shortcode__-param data-is-shortcode=&quot;1&quot; data-value=&quot;many-body-wavefunctions&quot; data-raw=&quot;&quot;many-body-wavefunctions&quot;&quot;} ]{.quarto-shortcode__ data-is-shortcode=&quot;1&quot; data-raw=&quot;{{< ref &quot;many-body-wavefunctions&quot; >}}&quot;}">Lecture 1</a> we introduced the <strong>single particle density matrix</strong></p>
<p><span class="math display">\[
    g(\mathbf{r},\mathbf{r}') \equiv N \int d\mathbf{r}_{2}\cdots d\mathbf{r}_{N}\,\Psi^{*}(\mathbf{r},\mathbf{r}_{2},\ldots,\mathbf{r}_{N})\Psi(\mathbf{r}',\mathbf{r}_{2},\ldots,\mathbf{r}_{N}).
\]</span></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Check
</div>
</div>
<div class="callout-body-container callout-body">
<p>Show that this can be written in terms of our field operators as</p>
<p><span class="math display">\[
\label{2nd_quant_SPDensity}
g(\mathbf{r},\mathbf{r}')= \langle{\Psi}\rvert \psi^\dagger(\mathbf{r})\psi^{\vphantom{\dagger}}(\mathbf{r}') \lvert \Psi \rangle.
\]</span></p>
</div>
</div>
<p>Notice that <span class="math inline">\(g(\mathbf{r},\mathbf{r})=\langle{\Psi}\rvert \hat\rho(\mathbf{r}) \lvert \Psi \rangle\)</span>. A slight generalization of the above calculation for the density gives for the state <span class="math inline">\(\lvert{\mathbf{N}}\rangle\)</span></p>
<p><span class="math display">\[
    \label{2nd_quant_SPFock}
    g(\mathbf{r},\mathbf{r}') = \sum_{\alpha} N_{\alpha}\varphi_{\alpha}^{*}(\mathbf{r})\varphi^{}_{\alpha}(\mathbf{r}').
\]</span></p>
<p>In <a href="[ref []{.quarto-shortcode__-param data-is-shortcode=&quot;1&quot; data-value=&quot;many-body-wavefunctions&quot; data-raw=&quot;&quot;many-body-wavefunctions&quot;&quot;} ]{.quarto-shortcode__ data-is-shortcode=&quot;1&quot; data-raw=&quot;{{< ref &quot;many-body-wavefunctions&quot; >}}&quot;}">Lecture 1</a> we evaluated <span class="math inline">\(g(x,y)\)</span> for the ground state of a 1D Fermi gas using the Slater determinant form of the wavefunction. For variety, let’s calculate it using our new method for the 3D Fermi gas. Recall that in this case <span class="math inline">\(N_{\mathbf{k}}=1\)</span> for <span class="math inline">\(\lvert{\mathbf{k}}\rvert&lt;k_{F}\)</span>, and <span class="math inline">\(0\)</span> otherwise. Thus the ground state can be written</p>
<p><span class="math display">\[
\lvert{\text{Fermi sea}}\rangle = \prod_{|\mathbf{k}|&lt;k_F} a^\dagger_\mathbf{k}\lvert{\text{VAC}}\rangle
\]</span></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Check
</div>
</div>
<div class="callout-body-container callout-body">
<p>Show that</p>
<p><span class="math display">\[
\begin{aligned}
\label{2nd_quant_FermiDensityMatrix}
g(\mathbf{r},\mathbf{r}')=\frac{1}{V}\sum_{|\mathbf{k}|&lt;k_{F}} e^{i\mathbf{k}\cdot(\mathbf{r}'-\mathbf{r})}&amp;=\int_{|\mathbf{k}|&lt;k_{F}} \frac{d\mathbf{k}}{(2\pi)^{3}}\,e^{i\mathbf{k}\cdot(\mathbf{r}'-\mathbf{r})}\nonumber\\
&amp;=\frac{k_{F}^{3}}{2\pi^{2}}\left[\frac{\sin\left(k_{F}|\mathbf{r}'-\mathbf{r}|\right)}{(k_{F}|\mathbf{r}'-\mathbf{r}|)^{3}}-\frac{\cos\left(k_{F}|\mathbf{r}'-\mathbf{r}|\right)}{(k_{F}|\mathbf{r}'-\mathbf{r}|)^{2}}\right].
\end{aligned}
\]</span></p>
<p>Note that <span class="math inline">\(g(\mathbf{r},\mathbf{r})=\frac{k_{F}^{3}}{6\pi^{2}}=n\)</span>, as it should. Also, <span class="math inline">\(g(\mathbf{r},\mathbf{r}')\to 0\)</span> as <span class="math inline">\(\lvert{\mathbf{r}-\mathbf{r}'}\rvert\to\infty\)</span>.</p>
</div>
</div>
<p>Contrast this calculation with the wavefunction version.</p>
<p><img src="../assets/FermiDensityMatrixCut.png" class="img-fluid" style="width:50.0%"></p>
</section>
<section id="two-particle-operators" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="two-particle-operators"><span class="header-section-number">3.2</span> Two Particle Operators</h3>
<p>A <strong>two particle operator</strong> acts pairwise on the particles</p>
<p><span id="eq-two-particle"><span class="math display">\[
\hat B = \sum_{j&lt;k} B_{jk}.
\tag{24}\]</span></span></p>
<p>Note that <span class="math inline">\(B_{jk}=B_{kj}\)</span> for indistinguishable particles, and that <span class="math inline">\(j=k\)</span> is excluded. The most important two particle operator that we will encounter describes interactions between pairs of particles, usually of the form <span id="eq-H-int"><span class="math display">\[
\hat H_\text{int.} = \sum_{j&lt;k} U(\mathbf{r}_j-\mathbf{r}_k).
\tag{25}\]</span></span></p>
<p>Similar to the single particle case, the action of <span class="math inline">\(\hat B\)</span> on a two particle product state <span class="math inline">\(\lvert{\varphi_{\alpha}}\rangle_1\lvert{\varphi_{\beta}}\rangle_2\)</span> can be expressed in terms of the matrix elements <span class="math display">\[
\begin{align}
B_{\alpha\beta,\gamma\delta} &amp;= \langle{\varphi_\alpha}\rvert\langle{\varphi_\beta}\rvert B_{12} \lvert{\varphi_\gamma}\rangle\lvert{\varphi_\delta}\rangle\nonumber\\
&amp;=\int d\mathbf{r}d\mathbf{r}' \varphi_\alpha^*(\mathbf{r})\varphi_\beta^*(\mathbf{r}')B_{12}\varphi_\gamma(\mathbf{r})\varphi_\delta(\mathbf{r}')
\end{align}
\]</span></p>
<p>Note that since <span class="math inline">\(B_{12}=B_{21}\)</span> we have <span class="math inline">\(B_{\alpha\beta,\gamma\delta}=B_{\beta\alpha,\delta\gamma}\)</span>. In the first quantized representation we have <span class="math display">\[
B_{12} = \sum_{\alpha\beta\gamma\delta}B_{\alpha\beta,\gamma\delta}\lvert{\varphi_\alpha}\rangle\lvert{\varphi_\beta}\rangle\langle{\varphi_\gamma}\rvert\langle{\varphi_\delta}\rvert.
\]</span> Now we’ll argue that the second quantized representation of <span class="math inline">\(\hat B\)</span> is <span id="eq-2-part"><span class="math display">\[
\hat B = \frac{1}{2}\sum_{\alpha\beta\gamma\delta} B_{\alpha\beta,\gamma\delta}a^\dagger_\alpha a^\dagger_\beta a^{\vphantom{\dagger}}_\delta a^{\vphantom{\dagger}}_\gamma.
\tag{26}\]</span></span></p>
<p>(Note the order, which is important for fermions!).</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Check
</div>
</div>
<div class="callout-body-container callout-body">
<p>Check that <a href="#eq-2-part" class="quarto-xref">Equation&nbsp;26</a> has the correct action on product states, starting with the two particle state</p>
<p><span class="math display">\[
a^\dagger_\gamma a^\dagger_\delta\lvert{\text{VAC}}\rangle\longleftrightarrow \frac{1}{\sqrt{2}}\left[\varphi_\gamma(\mathbf{r}_1)\varphi_\delta(\mathbf{r}_2)\pm \varphi_\delta(\mathbf{r}_1)\varphi_\gamma(\mathbf{r}_2)\right]
\]</span> For example, in the first quantized picture we have <span class="math display">\[
\begin{align}
B_{12}\frac{1}{\sqrt{2}}\left[\varphi_\gamma(\mathbf{r}_1)\varphi_\delta(\mathbf{r}_2)\pm \varphi_\delta(\mathbf{r}_1)\varphi_\gamma(\mathbf{r}_2)\right]&amp;=\frac{1}{\sqrt{2}}\sum_{\alpha\beta}\left[B_{\alpha\beta,\gamma\delta}\pm B_{\alpha\beta,\delta\gamma}\right]\varphi_\alpha(\mathbf{r}_1)\varphi_\beta(\mathbf{r}_2).
\end{align}
\]</span> Note that this is (anti-)symmetric for bosons (fermions) by virtue of <span class="math inline">\(B_{\alpha\beta,\gamma\delta}=B_{\beta\alpha,\delta\gamma}\)</span>. In second quantized notation the resulting state is written <span class="math display">\[
\frac{1}{\sqrt{2}}\sum_{\alpha\beta}\left[B_{\alpha\beta,\gamma\delta}\pm B_{\alpha\beta,\delta\gamma}\right]\varphi_\alpha(\mathbf{r}_1)\varphi_\beta(\mathbf{r}_2)\longleftrightarrow\sum_{\alpha\beta}B_{\alpha\beta}a^\dagger_\alpha a^\dagger_\beta\lvert{\text{VAC}}\rangle
\]</span> Which is the same as we get if we act with <a href="#eq-2-part" class="quarto-xref">Equation&nbsp;26</a> <span class="math display">\[
\left(\frac{1}{2}\sum_{\alpha\beta cd} B_{\alpha\beta,cd}a^\dagger_\alpha a^\dagger_\beta a^{\vphantom{\dagger}}_da^{\vphantom{\dagger}}_c\right)a^\dagger_\gamma a^\dagger_\delta\lvert{\text{VAC}}\rangle=\sum_{\alpha\beta}B_{\alpha\beta}a^\dagger_\alpha a^\dagger_\beta\lvert{\text{VAC}}\rangle.
\]</span> Make sure to trace down factor of 2!</p>
</div>
</div>
<p>The analog of the formula <a href="#eq-Aab" class="quarto-xref">Equation&nbsp;21</a> for the matrix elements of a two particle operator between two product states is <span class="math display">\[
\langle{\mathbf{N}}\rvert \hat B \lvert \mathbf{N'} \rangle =\left[B_{\alpha\beta,\gamma\delta}\pm B_{\alpha\beta,\delta\gamma}\right] \sqrt{N_\alpha N_\beta N'_\gamma N'_\delta},
\label{A_Babcd}
\]</span> with <span class="math inline">\(N_{\gamma,\delta} = N'_{\gamma,\delta}-1\)</span> and <span class="math inline">\(N_{\alpha,\beta} = N'_{\alpha,\beta}+1\)</span>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Check
</div>
</div>
<div class="callout-body-container callout-body">
<p>Strictly this formula is not correct when <span class="math inline">\(\gamma=\delta\)</span> or <span class="math inline">\(\alpha=\beta\)</span>. In the former case <span class="math inline">\(N'_\gamma N'_\delta \to N'_\gamma (N'_\gamma-1)\)</span> and in the latter <span class="math inline">\(N_\alpha N_\beta \to N_\alpha (N_\alpha-1)\)</span>. In the thermodynamic limit these terms usually make a vanishing contribution when sums are replaced with integrals. There are exceptions: when a finite fraction of the particles are in one state (which occurs for Bose—Einstein condensates, for example). In those cases we end up neglecting <span class="math inline">\(N_\alpha-1\)</span> relative to <span class="math inline">\(N_\alpha\)</span>, however!</p>
</div>
</div>
<p>Returning to the interaction <a href="#eq-H-int" class="quarto-xref">Equation&nbsp;25</a>, we can express this operator in the position basis as</p>
<p><span class="math display">\[
\hat H_\text{int.} = \frac{1}{2}\int d\mathbf{r}_1 d\mathbf{r}_2\, U(\mathbf{r}_1-\mathbf{r}_2)\psi^\dagger(\mathbf{r}_1)\psi^\dagger(\mathbf{r}_2)\psi^{\vphantom{\dagger}}(\mathbf{r}_2)\psi^{\vphantom{\dagger}}(\mathbf{r}_1).
\]</span></p>
<p>Remembering that <span class="math inline">\(\rho(\mathbf{r}) = \psi^\dagger(\mathbf{r})\psi^{\vphantom{\dagger}}(\mathbf{r})\)</span>, this is <em>almost</em> the same as</p>
<p><span id="eq-V-not-normal"><span class="math display">\[
\hat H_\text{int.} = \frac{1}{2}\int d\mathbf{r}_1 d\mathbf{r}_2\, U(\mathbf{r}_1-\mathbf{r}_2)\rho(\mathbf{r}_1)\rho(\mathbf{r}_2).
\tag{27}\]</span></span></p>
<p>The difference lies in the order of the operators, which prevents a particle from interacting with itself. Operators in which all annihilation operators stand to the right of all creation operators are said to be <strong>normal ordered</strong>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Check
</div>
</div>
<div class="callout-body-container callout-body">
<p>Check that <a href="#eq-V-not-normal" class="quarto-xref">Equation&nbsp;27</a> has a zero expectation value in a 1 particle state.</p>
</div>
</div>
<p>As an example, let’s write the Hamiltonian of interacting bosons that we met in <a href="[ref []{.quarto-shortcode__-param data-is-shortcode=&quot;1&quot; data-value=&quot;many-body-wavefunctions&quot; data-raw=&quot;&quot;many-body-wavefunctions&quot;&quot;} ]{.quarto-shortcode__ data-is-shortcode=&quot;1&quot; data-raw=&quot;{{< ref &quot;many-body-wavefunctions&quot; >}}&quot;}">Lecture 1</a> in our new formalism. <span class="math display">\[
H = \int dx \left[\frac{1}{2}\partial_x\psi^\dagger(x)\partial_x\psi^{\vphantom{\dagger}}(x) + \frac{c}{2}\psi^\dagger(x)\psi^\dagger(x)\psi^{\vphantom{\dagger}}(x)\psi^{\vphantom{\dagger}}(x)\right],
\]</span></p>
<p>where <span class="math inline">\(\psi^{\vphantom{\dagger}}(x)\)</span>, <span class="math inline">\(\psi^\dagger(x)\)</span> satisfy the canonical bosonic commutation relations <a href="#eq-position-relations" class="quarto-xref">Equation&nbsp;14</a>.</p>
<p>We’ve succeeded in translating an interacting many body Hamiltonian into a quantum field theory. But we shouldn’t feel too smug. As I said earlier, this is a change of <em>language</em>, and its usefulness is not guaranteed. The same warning applies to alternative formulations of the same problem: as a functional integral, for example. In the case of the Lieb–Liniger model, the exact solution was best presented in the first quantized, many body wavefunction framework. Ditto for the Laughlin states of the fractional quantum Hall effect. However, in approximate treatments of many body problems that we <em>can’t</em> solve exactly, like the Bose gas in higher dimensions that we’ll discuss in <a href="../notes/bose-gas.html">Lecture 8</a>, the second quantized framework is often a good starting point.</p>
</section>
</section>
<section id="appendix-alternative-derivation-of-one--and-two-particle-operators" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="appendix-alternative-derivation-of-one--and-two-particle-operators"><span class="header-section-number">4</span> Appendix: Alternative Derivation of One- and Two-particle Operators</h2>
<p>Here we give simpler derivation of the general form of one- and two- particle operators using the form <a href="#eq-freeze" class="quarto-xref">Equation&nbsp;15</a> for the action of the field operator <span class="math inline">\(\psi(x)\)</span>, which applies in both the bosonic and fermionic cases</p>
<section id="one-particle-operators-1" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="one-particle-operators-1"><span class="header-section-number">4.1</span> One particle operators</h3>
<p>We show that the one-particle operator <span class="math inline">\(\hat A\)</span> in <a href="#eq-one-particle" class="quarto-xref">Equation&nbsp;17</a> has the representation</p>
<p><span class="math display">\[
\hat A = \int \psi^\dagger(x_1) [A_{x_1} \psi^{\vphantom{\dagger}}({x_1})]\, d{x_1}
\]</span></p>
<p>where the subscript on <span class="math inline">\(A_{x}\)</span> is to indicate that the operator acts on the field operator <span class="math inline">\(\psi^{\vphantom{\dagger}}(x)\)</span> as if it were a wavefunction e.g.&nbsp;the momentum operator acts as <span class="math inline">\(p \psi^{\vphantom{\dagger}}(x)=-id\psi^{\vphantom{\dagger}}(x)/dx\)</span>. We now evaluate an arbitrary matrix element of the operator between states <span class="math inline">\(\lvert{\Psi}\rangle\)</span> and <span class="math inline">\(\lvert{\Phi}\rangle\)</span> (of any form, not necessarily product states) using <a href="#eq-freeze" class="quarto-xref">Equation&nbsp;15</a></p>
<p><span class="math display">\[
\begin{align}
\langle{\Psi}\rvert \hat A \lvert \Phi \rangle &amp;=  \int \langle{\Psi}\rvert \psi^\dagger(x_1) [A_{x_1} \psi^{\vphantom{\dagger}}(x_1)] \lvert \Phi \rangle\, dx_1 \\
&amp;= N \int \Psi^*(x_1,x_2,\ldots x_{N})\left[A_{x_1} \Phi(x_1,x_2,\dots x_{N})\right]dx_1 dx_2\ldots dx_{N}\\
&amp;=\sum_{j=1}^N  \int  \Psi^*(x_1,x_2,\ldots x_{N})\left[A_{x_j} \Phi(x_1,x_2,\dots x_{N})\right]dx_1 dx_2\ldots dx_{N}.
\end{align}
\]</span></p>
<p>The last line is just the matrix element of <a href="#eq-one-particle" class="quarto-xref">Equation&nbsp;17</a> in the first quantized representation. Note that all terms in the sum over <span class="math inline">\(j\)</span> are identical because we can permute the arguments of <span class="math inline">\(\Psi\)</span> and <span class="math inline">\(\Phi\)</span> to bring the argument <span class="math inline">\(x_j\)</span> to the first position. Any sign in the fermionic case is squared and therefore has no effect.</p>
</section>
<section id="two-particle-operators-1" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="two-particle-operators-1"><span class="header-section-number">4.2</span> Two particle operators</h3>
<p>We show that the general two particle operator <a href="#eq-two-particle" class="quarto-xref">Equation&nbsp;24</a> has representation</p>
<p><span class="math display">\[
\hat B =\frac{1}{2} \int \psi^\dagger(x_1)\psi^\dagger(x_2) [B_{x_1,x_2} \psi^{\vphantom{\dagger}}(x_2)\psi^{\vphantom{\dagger}}(x_1)]\, dx_1 dx_2,
\]</span></p>
<p>where <span class="math inline">\(B_{x_1,x_2}\)</span> is an operator that acts on a pair of wavefunctions. Taking matrix elements and using <a href="#eq-freeze" class="quarto-xref">Equation&nbsp;15</a> again yields</p>
<p><span class="math display">\[
\begin{align}
\langle{\Psi}\rvert \hat B \lvert \Phi \rangle &amp;= \frac{1}{2} \int \langle{\Psi}\rvert \psi^\dagger(x_1)\psi^\dagger(x_2) [B_{x_1,x_2} \psi^{\vphantom{\dagger}}(x_2)\psi^{\vphantom{\dagger}}(x_1)] \lvert \Phi \rangle\, dx_1 dx_2\\
&amp;= \frac{1}{2}N(N-1) \int \Psi^*(x_1,x_2,\ldots x_{N})\left[B_{x_1,x_2} \Phi(x_1,x_2,\dots x_{N})\right]dx_1 dx_2\ldots dx_{N}\\
&amp;=\sum_{j&lt;k}  \int  \Psi^*(x_1,x_2,\ldots x_{N})\left[B_{x_j,x_k} \Phi(x_1,x_2,\dots x_{N})\right]dx_1 dx_2\ldots dx_{N}.
\end{align}
\]</span></p>
<p>The last line is the first quantized representation of the matrix elements of <a href="#eq-two-particle" class="quarto-xref">Equation&nbsp;24</a>. Again all terms in the sum over pairs are identical by (anti-)symmetry of the wavefunctions.</p>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-baym2018lectures" class="csl-entry" role="listitem">
Baym, Gordon. 2018. <em>Lectures on Quantum Mechanics</em>. CRC Press.
</div>
<div id="ref-nazarov2013advanced" class="csl-entry" role="listitem">
Nazarov, Yuli V, and Jeroen Danon. 2013. <em>Advanced Quantum Mechanics: A Practical Guide</em>. Cambridge University Press.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../notes/spin-models.html" class="pagination-link" aria-label="Spin Models">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Spin Models</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../notes/more-second-quantization.html" class="pagination-link" aria-label="B is for Bunching">
        <span class="nav-page-text">B is for Bunching</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>